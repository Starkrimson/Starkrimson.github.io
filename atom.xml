<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>.init()</title>
  
  
  <link href="https://starkrimson.github.io/atom.xml" rel="self"/>
  
  <link href="https://starkrimson.github.io/"/>
  <updated>2022-04-08T01:13:01.262Z</updated>
  <id>https://starkrimson.github.io/</id>
  
  <author>
    <name>Starkrimson</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>çœŸå®ä¸–ç•Œçš„ SwiftUI+TCAï¼šå¤©æ°” App</title>
    <link href="https://starkrimson.github.io/2022/04/07/weather-app/"/>
    <id>https://starkrimson.github.io/2022/04/07/weather-app/</id>
    <published>2022-04-07T13:00:00.000Z</published>
    <updated>2022-04-08T01:13:01.262Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WeatherApp"><a href="#WeatherApp" class="headerlink" title="WeatherApp"></a>WeatherApp</h1><p><a href="https://github.com/Starkrimson/WeatherApp">æºç </a>åœ¨ GitHub</p><blockquote><p><a href="https://objccn.io/products/swift-ui">ã€ŠSwiftUI ä¸ Combine ç¼–ç¨‹ã€‹(å–µç¥)</a> è¯»åå®è·µ</p></blockquote><p>ä¸€ä¸ªå¤©æ°” Appï¼Œå¯æœç´¢ã€å…³æ³¨åŸå¸‚ï¼ŒæŸ¥çœ‹åŸå¸‚è¯¦ç»†å¤©æ°”é¢„æŠ¥ã€‚</p><p>ç”± SwiftUI é©±åŠ¨çš„è·¨å¹³å° appï¼ŒåŒ…æ‹¬ UI å¸ƒå±€ã€çŠ¶æ€ç®¡ç†ã€ç½‘ç»œæ•°æ®è·å–å’Œæœ¬åœ°æ•°æ®å­˜å‚¨ç­‰ç­‰ã€‚</p><p>ç¼–è¯‘ç¯å¢ƒï¼šmacOS 12.0.1, Xcode 13.3, iOS 15.4</p><p><a href="https://user-images.githubusercontent.com/16103570/160243859-863413ce-c1ca-4775-8c56-3a322cef9f30.mp4">https://user-images.githubusercontent.com/16103570/160243859-863413ce-c1ca-4775-8c56-3a322cef9f30.mp4</a></p><h3 id="The-Composable-Architecture-å¯ç»„è£…æ¶æ„"><a href="#The-Composable-Architecture-å¯ç»„è£…æ¶æ„" class="headerlink" title="The Composable Architecture å¯ç»„è£…æ¶æ„"></a><a href="https://github.com/pointfreeco/swift-composable-architecture">The Composable Architecture</a> å¯ç»„è£…æ¶æ„</h3><blockquote><p><a href="https://gist.github.com/sh3l6orrr/10c8f7c634a892a9c37214f3211242ad">TCA ä¸­æ–‡ readme</a></p></blockquote><ul><li>Stateï¼šå³çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªç”¨äºæè¿°æŸä¸ªåŠŸèƒ½çš„æ‰§è¡Œé€»è¾‘ï¼Œå’Œæ¸²æŸ“ç•Œé¢æ‰€éœ€çš„æ•°æ®çš„ç±»ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SearchState</span>: <span class="title class_">Equatable</span> &#123;</span><br><span class="line">    <span class="meta">@BindableState</span> <span class="keyword">var</span> searchQuery <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> list: [<span class="type">Find</span>.<span class="type">City</span>] <span class="operator">=</span> []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Actionï¼šä¸€ä¸ªä»£è¡¨åœ¨åŠŸèƒ½ä¸­æ‰€æœ‰å¯èƒ½çš„åŠ¨ä½œçš„ç±»ï¼Œå¦‚ç”¨æˆ·çš„è¡Œä¸ºã€æé†’ï¼Œå’Œäº‹ä»¶æºç­‰ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">SearchAction</span>: <span class="title class_">Equatable</span>, <span class="title class_">BindableAction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> binding(<span class="type">BindingAction</span>&lt;<span class="type">SearchState</span>&gt;)</span><br><span class="line">    <span class="keyword">case</span> search(query: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> citiesResponse(<span class="type">Result</span>&lt;[<span class="type">Find</span>.<span class="type">City</span>], <span class="type">AppError</span>&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Environmentï¼šä¸€ä¸ªåŒ…å«åŠŸèƒ½çš„ä¾èµ–çš„ç±»ï¼Œå¦‚APIå®¢æˆ·ç«¯ï¼Œåˆ†æå®¢æˆ·ç«¯ç­‰ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SearchEnvironment</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> mainQueue: <span class="type">AnySchedulerOf</span>&lt;<span class="type">DispatchQueue</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> weatherClient: <span class="type">WeatherClient</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Reducerï¼šä¸€ä¸ªç”¨äºæè¿°è§¦å‘ã€ŒActionã€æ—¶ï¼Œå¦‚ä½•ä»å½“å‰çŠ¶æ€ï¼ˆstateï¼‰å˜åŒ–åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€çš„å‡½æ•°ï¼Œå®ƒåŒæ—¶è´Ÿè´£è¿”å›ä»»ä½•éœ€è¦è¢«æ‰§è¡Œçš„ã€ŒEffectã€ï¼Œå¦‚APIè¯·æ±‚ï¼ˆé€šè¿‡è¿”å›ä¸€ä¸ªã€ŒEffectã€å®ä¾‹æ¥å®Œæˆï¼‰ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> searchReducer <span class="operator">=</span> <span class="type">Reducer</span>&lt;<span class="type">SearchState</span>, <span class="type">SearchAction</span>, <span class="type">SearchEnvironment</span>&gt; &#123;</span><br><span class="line">    state, action, environment <span class="keyword">in</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> action &#123;</span><br><span class="line">    <span class="keyword">case</span> .binding:</span><br><span class="line">        <span class="keyword">return</span> .none</span><br><span class="line">    <span class="keyword">case</span> .search(<span class="keyword">let</span> query):</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">SearchCityId</span>: <span class="title class_">Hashable</span> &#123; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> environment.weatherClient</span><br><span class="line">            .searchCity(query)</span><br><span class="line">            .receive(on: environment.mainQueue)</span><br><span class="line">            .catchToEffect(<span class="type">SearchAction</span>.citiesResponse)</span><br><span class="line">            .cancellable(id: <span class="type">SearchCityId</span>(), cancelInFlight: <span class="literal">true</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">case</span> .citiesResponse(<span class="keyword">let</span> result):</span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> list):</span><br><span class="line">            state.list <span class="operator">=</span> list</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">            state.list <span class="operator">=</span> []</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> .none</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    .binding()</span><br><span class="line">    .debug()</span><br></pre></td></tr></table></figure><ul><li>Storeï¼šç”¨äºé©±åŠ¨æŸä¸ªåŠŸèƒ½çš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ã€‚å°†æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºå‘é€åˆ°ã€ŒStoreã€ä¸­ï¼Œä»¤å®ƒè¿è¡Œã€ŒReducerã€å’Œã€ŒEffectsã€ã€‚åŒæ—¶ä»ã€ŒStoreã€ä¸­è§‚æµ‹ã€ŒStateã€ï¼Œä»¥æ›´æ–°UIã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchView</span>(</span><br><span class="line">    store: .<span class="keyword">init</span>(</span><br><span class="line">        initialState: .<span class="keyword">init</span>(),</span><br><span class="line">        reducer: weatherReducer,</span><br><span class="line">        environment: <span class="type">WeatherEnvironment</span>(mainQueue: .main, weatherClient: .live)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SearchView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> store: <span class="type">Store</span>&lt;<span class="type">WeatherState</span>, <span class="type">WeatherAction</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WithViewStore</span>(searchStore) &#123; viewStore <span class="keyword">in</span></span><br><span class="line">            <span class="type">List</span>(viewStore.list) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">Cell</span>(<span class="operator">...</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .searchable(text: viewStore.binding(\.<span class="variable">$searchQuery</span>))</span><br><span class="line">            .onSubmit(of: .search) &#123;</span><br><span class="line">                viewStore.send(.search(query: viewStore.searchQuery))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ å’Œå¯¼èˆª"><a href="#åˆ†æ å’Œå¯¼èˆª" class="headerlink" title="åˆ†æ å’Œå¯¼èˆª"></a>åˆ†æ å’Œå¯¼èˆª</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NavigationView</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ª view ä¸ºå·¦ä¾§ sidebar</span></span><br><span class="line">    <span class="type">List</span> &#123;</span><br><span class="line">        <span class="comment">// ç‚¹å‡» link ä¼š push åˆ° destinationï¼›å¦‚æœæ˜¯åˆ†å±ä¸‹ï¼Œdestination ä¼šæ˜¾ç¤ºåœ¨ detailViewã€‚</span></span><br><span class="line">        <span class="type">NavigationLink</span>(destination: <span class="type">CityView</span>(city: city)) &#123;</span><br><span class="line">            <span class="type">Text</span>(city.description)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ª view ä¸ºå³ä¾§ detail view</span></span><br><span class="line">    <span class="type">Image</span>(systemName: <span class="string">&quot;cloud.sun&quot;</span>).font(.largeTitle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">WeatherClient</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> searchCity: (<span class="type">String</span>) -&gt; <span class="type">Effect</span>&lt;[<span class="type">Find</span>.<span class="type">City</span>], <span class="type">AppError</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">WeatherClient</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> live <span class="operator">=</span> <span class="type">WeatherClient</span>(</span><br><span class="line">        searchCity: &#123; query <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> q <span class="operator">=</span> query.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed),</span><br><span class="line">                  <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://openweathermap.org/data/2.5/find?q=<span class="subst">\(q)</span>&amp;appid=<span class="subst">\(appid)</span>&amp;units=metric&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Effect</span>(error: .badURL)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url)</span><br><span class="line">                .map &#123; <span class="variable">$0</span>.data &#125;</span><br><span class="line">                .decode(type: <span class="type">Find</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">                .map &#123; <span class="variable">$0</span>.list &#125;</span><br><span class="line">                .mapError &#123; <span class="type">AppError</span>.networkingFailed(<span class="variable">$0</span>) &#125;</span><br><span class="line">                .eraseToEffect()</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h3 id="å±å¹•é€‚é…"><a href="#å±å¹•é€‚é…" class="headerlink" title="å±å¹•é€‚é…"></a>å±å¹•é€‚é…</h3><p>é€šè¿‡ <code>@Environment</code> è·å– <code>horizontalSizeClass</code> ç¯å¢ƒå˜é‡ã€‚</p><p>å½“ <code>horizontalSizeClass == .compact</code>ï¼Œå¯èƒ½æ˜¯ç«–å±çš„ iPhone æˆ–è€…åˆ†å±ä¸‹çš„ iPadã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Environment</span>(\.horizontalSizeClass) <span class="keyword">var</span> horizontalSizeClass: <span class="type">UserInterfaceSizeClass</span>?</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> horizontalSizeClass <span class="operator">==</span> .compact &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·è¿˜æœ‰ <code>verticalSizeClass</code></p><h3 id="æ•°æ®æ¥æº"><a href="#æ•°æ®æ¥æº" class="headerlink" title="æ•°æ®æ¥æº"></a>æ•°æ®æ¥æº</h3><p><a href="https://openweathermap.org/"><img alt="openweathermap" src="https://openweathermap.org/themes/openweathermap/assets/img/logo_white_cropped.png" width="120"/></a> <a href="https://openweathermap.org/">openweathermap.org</a></p><p>æºç ä¸å« appidï¼Œéœ€è¦ç¼–è¯‘çœ‹æ•ˆæœå¯ä»¥å»å®˜ç½‘æ³¨å†Œå…è´¹çš„ appidã€‚ç„¶åèµ‹å€¼ <code>WeatherClient.swift</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> appid <span class="operator">=</span> <span class="string">&quot;xxx&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;WeatherApp&quot;&gt;&lt;a href=&quot;#WeatherApp&quot; class=&quot;headerlink&quot; title=&quot;WeatherApp&quot;&gt;&lt;/a&gt;WeatherApp&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/Starkrimso</summary>
      
    
    
    
    
    <category term="SwiftUI" scheme="https://starkrimson.github.io/tags/SwiftUI/"/>
    
    <category term="TCA" scheme="https://starkrimson.github.io/tags/TCA/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–å†™ dart å‘½ä»¤è¡Œç¨‹åº</title>
    <link href="https://starkrimson.github.io/2021/07/21/dart-command-line-application/"/>
    <id>https://starkrimson.github.io/2021/07/21/dart-command-line-application/</id>
    <published>2021-07-21T02:00:00.000Z</published>
    <updated>2022-04-07T04:04:05.530Z</updated>
    
    <content type="html"><![CDATA[<p>dart command-line application</p><span id="more"></span><h3 id="1ï¸âƒ£-åˆ›å»ºåº”ç”¨"><a href="#1ï¸âƒ£-åˆ›å»ºåº”ç”¨" class="headerlink" title="1ï¸âƒ£ åˆ›å»ºåº”ç”¨"></a>1ï¸âƒ£ åˆ›å»ºåº”ç”¨</h3><p>ä½¿ç”¨Â <code>dart create</code>Â å‘½ä»¤ï¼Œä»¥Â <code>console-full</code>Â æ¨¡æ¿åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dart create -t console-full cli</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«ä¸‹è¿°ä¿¡æ¯çš„ Dart åº”ç”¨ï¼š</p><ul><li>ä¸€ä¸ªä¸»è¦çš„ Dart æºæ–‡ä»¶ï¼Œ<code>bin/cli.dart</code>ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªé¡¶å±‚Â <code>main()</code>Â å‡½æ•°ã€‚è¯¥å‡½æ•°æ˜¯ä½ åº”ç”¨çš„å…¥å£ã€‚</li><li>ä¸€ä¸ªé¢å¤–çš„ Dart æ–‡ä»¶ï¼Œ<code>lib/cli.dart</code>ï¼ŒåŒ…å«ä¸€äº›åŠŸèƒ½æ€§çš„å‡½æ•°æ–¹æ³•ï¼Œè¿™äº›å‡½æ•°æ–¹æ³•å°†ä¼šå¯¼å…¥åˆ°Â <code>cli.dart</code>Â æ–‡ä»¶ä¸­ã€‚</li><li>ä¸€ä¸ª pubspec æ–‡ä»¶ï¼Œ<code>pubspec.yaml</code>ï¼ŒåŒ…å«åº”ç”¨çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬åº”ç”¨ä¾èµ–çš„Â <a href="https://dart.cn/guides/packages">package</a>Â ä¿¡æ¯ä»¥åŠæ‰€éœ€çš„ç‰ˆæœ¬ç­‰ã€‚</li></ul><h3 id="2ï¸âƒ£-è¿è¡Œåº”ç”¨"><a href="#2ï¸âƒ£-è¿è¡Œåº”ç”¨" class="headerlink" title="2ï¸âƒ£ è¿è¡Œåº”ç”¨"></a>2ï¸âƒ£ è¿è¡Œåº”ç”¨</h3><p>ä½¿ç”¨ <code>dart run</code> å‘½ä»¤åœ¨åº”ç”¨çš„æ ¹ç›®å½•è¿è¡Œ Dart VMï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> cli</span><br><span class="line">$ dart run</span><br><span class="line">Hello world: 42!</span><br></pre></td></tr></table></figure><h3 id="3ï¸âƒ£-è¾“å…¥è¾“å‡º"><a href="#3ï¸âƒ£-è¾“å…¥è¾“å‡º" class="headerlink" title="3ï¸âƒ£ è¾“å…¥è¾“å‡º"></a>3ï¸âƒ£ è¾“å…¥è¾“å‡º</h3><p><code>stdin</code>, <code>stdout</code>, and <code>stderr</code>.</p><p>å¯¼å…¥ <code>dart:io</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import <span class="string">&#x27;dart:io&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li><p><code>stdout</code> The standard output</p>  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">stdout.write(<span class="string">&#x27;Hello &#x27;</span>); <span class="comment">// ä¸æ¢è¡Œ</span></span><br><span class="line">stdout.writeln(<span class="string">&#x27;World&#x27;</span>); <span class="comment">// æ¢è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">è¾“å‡º</span></span></span><br><span class="line">$ dart run bin/cli.dart</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure></li><li><p><code>stdin</code> The standard input</p>  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stdout.writeln(<span class="string">&#x27;Type something:&#x27;</span>);</span><br><span class="line"><span class="keyword">final</span> input = stdin.readLineSync(); <span class="comment">// ç­‰å¾…ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">stdout.writeln(<span class="string">&#x27;Yout typed: <span class="subst">$input</span>&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">è¾“å‡º</span></span></span><br><span class="line"><span class="built_in">Type</span> something:</span><br><span class="line">Hola</span><br><span class="line">Yout typed: Hola</span><br></pre></td></tr></table></figure></li><li><p><code>stderr</code> The standard input</p>  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (input != <span class="string">&#x27;Hola&#x27;</span>) &#123;</span><br><span class="line">  stderr.writeln(<span class="string">&#x27;error: input <span class="subst">$input</span> != \&#x27;Hola\&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Type</span> something:</span><br><span class="line">Hello</span><br><span class="line">Yout typed: Hello</span><br><span class="line">error: input Hello != <span class="string">&#x27;Hola&#x27;</span> <span class="comment">// stderr</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4ï¸âƒ£-å†™å…¥æ–‡ä»¶"><a href="#4ï¸âƒ£-å†™å…¥æ–‡ä»¶" class="headerlink" title="4ï¸âƒ£ å†™å…¥æ–‡ä»¶"></a>4ï¸âƒ£ å†™å…¥æ–‡ä»¶</h3><ul><li><p>æ–°å»ºæ–‡ä»¶ï¼Œå†™å…¥æ•°æ®ã€‚</p>  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> file = File(<span class="string">&#x27;text.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">final</span> str = <span class="string">&#x27;The quick brown fox jumps over the lazy dog.&#x27;</span>;</span><br><span class="line"><span class="keyword">await</span> file.writeAsString(str, mode: FileMode.write);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆ text.txt æ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></li><li><p>æ‰“å¼€æ–‡ä»¶ï¼Œå†™å…¥æ›´å¤šæ•°æ®ã€‚</p>  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> file = File(<span class="string">&#x27;text.txt&#x27;</span>).openWrite(mode: FileMode.append);</span><br><span class="line"></span><br><span class="line">file.write(<span class="string">&#x27;The quick brown fox &#x27;</span>);</span><br><span class="line">file.writeln(<span class="string">&#x27;jumps over the lazy dog.&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> file.close();</span><br></pre></td></tr></table></figure></li></ul><h3 id="5ï¸âƒ£-æ–‡ä»¶å¤¹æ“ä½œ"><a href="#5ï¸âƒ£-æ–‡ä»¶å¤¹æ“ä½œ" class="headerlink" title="5ï¸âƒ£ æ–‡ä»¶å¤¹æ“ä½œ"></a>5ï¸âƒ£ æ–‡ä»¶å¤¹æ“ä½œ</h3><p>å¯¼å…¥ <code>path</code> åº“ï¼š<code>import &#39;package:path/path.dart&#39;;</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> dir = Directory(<span class="string">&#x27;lib&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> dir.exists()) &#123;</span><br><span class="line">  dir.createSync(); <span class="comment">// æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> newFilePath = path.joinAll([dir.path, <span class="string">&#x27;cli.dart&#x27;</span>]); <span class="comment">// ä½¿ç”¨ path åº“ joinAll æ‹¼æ¥è·¯å¾„</span></span><br><span class="line">stdout.writeln(newFilePath);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> newFile = File(newFilePath).openWrite(mode: FileMode.write);</span><br><span class="line">newFile.writeln(<span class="string">&#x27;import \&#x27;dart:io\&#x27;;&#x27;</span>);</span><br><span class="line">newFile.writeln(<span class="string">&#x27;print(\&#x27;Hello World!\&#x27;);&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="6ï¸âƒ£-ä½¿ç”¨-platform-è·å–ç¯å¢ƒå˜é‡"><a href="#6ï¸âƒ£-ä½¿ç”¨-platform-è·å–ç¯å¢ƒå˜é‡" class="headerlink" title="6ï¸âƒ£ ä½¿ç”¨ platform è·å–ç¯å¢ƒå˜é‡"></a>6ï¸âƒ£ ä½¿ç”¨ <a href="https://api.dart.dev/stable/dart-io/Platform-class.html">platform</a> è·å–ç¯å¢ƒå˜é‡</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> envVarMap = Platform.environment;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;PWD = <span class="subst">$&#123;envVarMap[<span class="string">&quot;PWD&quot;</span>]&#125;</span>&#x27;</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;LOGNAME = <span class="subst">$&#123;envVarMap[<span class="string">&quot;LOGNAME&quot;</span>]&#125;</span>&#x27;</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;PATH = <span class="subst">$&#123;envVarMap[<span class="string">&quot;PATH&quot;</span>]&#125;</span>&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="7ï¸âƒ£-è®¾ç½®-exit-codes"><a href="#7ï¸âƒ£-è®¾ç½®-exit-codes" class="headerlink" title="7ï¸âƒ£ è®¾ç½® exit codes"></a>7ï¸âƒ£ è®¾ç½® exit codes</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">exitCode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0: Success</span></span><br><span class="line"><span class="comment">// 1: Warnings</span></span><br><span class="line"><span class="comment">// 2: Errors</span></span><br></pre></td></tr></table></figure><h3 id="8ï¸âƒ£-è§£æå‘½ä»¤è¡Œå‚æ•°"><a href="#8ï¸âƒ£-è§£æå‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="8ï¸âƒ£ è§£æå‘½ä»¤è¡Œå‚æ•°"></a>8ï¸âƒ£ è§£æå‘½ä»¤è¡Œå‚æ•°</h3><ol><li><p>æ·»åŠ  <a href="https://pub.flutter-io.cn/packages/args">args</a> ä¾èµ–</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">pubspec.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">args:</span></span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:args/args.dart&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ <code>ArgParser</code> è§£æ</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> parser = ArgParser()..addOption(<span class="string">&#x27;name&#x27;</span>, abbr: <span class="string">&#x27;n&#x27;</span>, help: <span class="string">&#x27;Greeting&#x27;</span>);</span><br><span class="line"><span class="keyword">final</span> argResults = parser.parse(arguments);</span><br><span class="line"><span class="keyword">final</span> name = argResults[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Hello <span class="subst">$name</span>!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line">$ pub run cli -n World</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure></li></ol><h3 id="9ï¸âƒ£-å¤šå‘½ä»¤-CommandRunner"><a href="#9ï¸âƒ£-å¤šå‘½ä»¤-CommandRunner" class="headerlink" title="9ï¸âƒ£ å¤šå‘½ä»¤  CommandRunner"></a>9ï¸âƒ£ å¤šå‘½ä»¤  <code>CommandRunner</code></h3><ol><li><p>å¯¼å…¥</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:args/command_runner.dart&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰å‘½ä»¤</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingCommand</span> <span class="keyword">extends</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">  GreetingCommand() &#123;</span><br><span class="line">    argParser.addOption(<span class="string">&#x27;name&#x27;</span>, abbr: <span class="string">&#x27;n&#x27;</span>, help: <span class="string">&#x27;Greeting&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> name =&gt; <span class="string">&#x27;greeting&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> description =&gt; <span class="string">&#x27;æ¬¢è¿&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> run() &#123;</span><br><span class="line">    <span class="keyword">final</span> name = argResults[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello <span class="subst">$name</span>!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ <code>CommandRunner</code> æ·»åŠ å‘½ä»¤</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arguments) &#123;</span><br><span class="line">  CommandRunner(<span class="string">&#x27;cli&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">    ..addCommand(GreetingCommand())</span><br><span class="line">    ..run(arguments);</span><br><span class="line"></span><br><span class="line">  exitCode = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‘½ä»¤è¡Œä½¿ç”¨è¯´æ˜ (help)</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cli å¸®åŠ©</span></span><br><span class="line">$ pub run cli -h</span><br><span class="line">desc</span><br><span class="line"></span><br><span class="line">Usage: cli &lt;command&gt; [arguments]</span><br><span class="line"></span><br><span class="line">Global options:</span><br><span class="line">-h, --help    Print <span class="keyword">this</span> usage information.</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line">  greeting   æ¬¢è¿</span><br><span class="line"></span><br><span class="line">Run <span class="string">&quot;cli help &lt;command&gt;&quot;</span> <span class="keyword">for</span> more information about a command.</span><br><span class="line"></span><br><span class="line"><span class="comment">// greeting å¸®åŠ©</span></span><br><span class="line">$ pub run cli greeting -h</span><br><span class="line">æ¬¢è¿</span><br><span class="line"></span><br><span class="line">Usage: cli greeting [arguments]</span><br><span class="line">-h, --help    Print <span class="keyword">this</span> usage information.</span><br><span class="line">-n, --name    Greeting</span><br><span class="line"></span><br><span class="line">Run <span class="string">&quot;cli help&quot;</span> to see global options.</span><br></pre></td></tr></table></figure></li></ol><h3 id="ğŸ”Ÿ-catch-error"><a href="#ğŸ”Ÿ-catch-error" class="headerlink" title="ğŸ”Ÿ catch error"></a>ğŸ”Ÿ catch error</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arguments) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> runner = CommandRunner&lt;<span class="built_in">int</span>&gt;(<span class="string">&#x27;cli&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">      ..addCommand(GreetingCommand());</span><br><span class="line">    <span class="keyword">final</span> result = <span class="keyword">await</span> runner.run(arguments);</span><br><span class="line">    exitCode = result;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e, s) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">is</span> UsageException) &#123;</span><br><span class="line">      <span class="built_in">print</span>(red.wrap(e.message));</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">      <span class="built_in">print</span>(e.usage);</span><br><span class="line">      exitCode = ExitCode.usage.code;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(red.wrap(e.toString()));</span><br><span class="line">      <span class="built_in">print</span>(red.wrap(s.toString()));</span><br><span class="line">      exitCode = ExitCode.unavailable.code;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ pub run cli greeting -n</span><br><span class="line">Missing argument <span class="keyword">for</span> <span class="string">&quot;name&quot;</span>.</span><br><span class="line"> </span><br><span class="line">Usage: cli greeting [arguments]</span><br><span class="line">-h, --help    Print <span class="keyword">this</span> usage information.</span><br><span class="line">-n, --name    Greeting</span><br><span class="line"></span><br><span class="line">Run <span class="string">&quot;cli help&quot;</span> to see global options.</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://dart.cn/tools/pub/cmd/pub-global">pub global å‘½ä»¤</a></p><p><a href="https://dart.cn/tutorials/server/cmdline">ç¼–å†™å‘½ä»¤è¡Œåº”ç”¨</a></p><p><a href="https://dart.cn/tutorials/server/get-started">èµ·æ­¥æ•™ç¨‹ï¼šç¼–å†™å‘½ä»¤è¡Œå’ŒæœåŠ¡ç«¯åº”ç”¨</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;dart command-line application&lt;/p&gt;</summary>
    
    
    
    
    <category term="Dart" scheme="https://starkrimson.github.io/tags/Dart/"/>
    
    <category term="command-line" scheme="https://starkrimson.github.io/tags/command-line/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ altool ä¸Šä¼  ipa è‡³ TestFlight</title>
    <link href="https://starkrimson.github.io/2018/11/15/upload-ipa-with-altool/"/>
    <id>https://starkrimson.github.io/2018/11/15/upload-ipa-with-altool/</id>
    <published>2018-11-15T07:17:00.000Z</published>
    <updated>2022-04-07T04:04:05.530Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥ä¸Šä¸€ç¯‡ï¼ŒJenkins æ„å»ºå®Œæˆåï¼Œä½¿ç”¨ altool å°† ipa ä¸Šä¼ è‡³ TestFlightã€‚</p><span id="more"></span><h3 id="altool"><a href="#altool" class="headerlink" title="altool"></a>altool</h3><p><strong>Xcode 11 ä¹‹åå·²ä¸å†æä¾› <code>Application Loader</code>ï¼Œæ”¹ç”¨ <code>xcrun altool</code> ä¸Šä¼  ipaã€‚</strong></p><p><del>altool æ˜¯ <code>Application Loader</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å’Œä¸Šä¼  app æ–‡ä»¶è‡³ App Storeã€‚</del></p><p>å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Applications/Xcode.app/Contents/Applications/Application\ Loader.app/Contents/Frameworks/ITunesSoftwareService.framework/Versions/A/Support/altool</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ -shell"><a href="#æ·»åŠ -shell" class="headerlink" title="æ·»åŠ  shell"></a>æ·»åŠ  shell</h3><p>åœ¨ <code>xcodebuild -exportArchive</code> æ­¥éª¤å®Œæˆåï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°ä¸€ä¸ªæ‰“åŒ…å¥½çš„ ipa æ–‡ä»¶ï¼Œæ³¨æ„å¯¼å‡ºä½¿ç”¨çš„ <code>ExportOptions.plist</code> é‡Œ <code>method</code> æ˜¯ <code>app-store</code>ã€‚</p><figure class="highlight plist"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>method<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>app-store<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ <code>Add build step -&gt; Execute Shell</code> æ·»åŠ ä¸€ä¸ªæ–°çš„ shell è„šæœ¬ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--upload-app ä¸Šä¼  --validate-app éªŒè¯</span></span><br><span class="line">xcrun altool --upload-app \</span><br><span class="line">-f path_to_app.ipa \</span><br><span class="line">-u email@sample.com \</span><br><span class="line">-p @keychain:APP_SPECIFIC \</span><br><span class="line">--output-format normal</span><br></pre></td></tr></table></figure><p>altool å¯ä»¥ <code>--validate-app</code> éªŒè¯å’Œ <code>--upload-app</code> ä¸Šä¼ ï¼Œ<code>-f</code> æŒ‡å‘ ipa åœ°å€ï¼Œ<code>-u</code> <code>-p</code> åˆ†åˆ«æ˜¯ Apple ID ç”¨æˆ·åå’Œå¯†ç ã€‚è¿™é‡Œå¯†ç éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœ Apple ID å¼€å¯äº†<strong>åŒé‡è®¤è¯</strong>ï¼Œéœ€è¦ç»™è¯¥ ID ç”Ÿæˆä¸€ä¸ª <code>APP-SPECIFIC PASSWORD</code>ã€‚</p><p><img src="/images/upload-ipa-with-altool/APP-SPECIFIC_PASSWORD.jpg" alt="image-20181115143746906"></p><p>å¦‚æœæœªå¼€å¯åŒé‡è®¤è¯ï¼Œé‚£ä¹ˆå¯†ç å°±æ˜¯ Apple ID çš„å¯†ç ã€‚</p><h3 id="keychain"><a href="#keychain" class="headerlink" title="@keychain"></a>@keychain</h3><p>åœ¨ shell è„šæœ¬ä¸­ä½¿ç”¨æ˜æ–‡å¯†ç æ˜¯ä¸ç†æ™ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Keychain æ¥ä¿å­˜å¯†ç ã€‚</p><p><img src="/images/upload-ipa-with-altool/keychain_APP_SPECIFIC.png" alt="image-20181115144841295"></p><p>åœ¨ Keychain Access æ–°å¢ itemã€‚æ¥ä¸‹æ¥ <code>-p @keychain:APP_SPECIFIC</code> æŒ‡å®š item name å°±å¥½äº†ã€‚æ³¨æ„ <code>Account Name</code> éœ€è¦å’Œ <code>-u username</code> ä¸€è‡´ã€‚</p><p>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚ä¸‹æç¤ºå°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">No errors validating archive at path_to_app.ipa</span><br><span class="line">No errors uploading &#x27;path_to_app.ipa&#x27;</span><br></pre></td></tr></table></figure><p>åè¿‡æ¥å¦‚æœæœ‰é”™è¯¯ï¼Œä¹Ÿä¼šæœ‰å¾ˆè¯¦ç»†çš„æç¤ºã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>--output-format xml</code> è·å¾—æ›´è¯¦ç»†çš„è¾“å‡ºã€‚ </p><h3 id="ä¸€ä¸ªå°æç¤º"><a href="#ä¸€ä¸ªå°æç¤º" class="headerlink" title="ä¸€ä¸ªå°æç¤º"></a>ä¸€ä¸ªå°æç¤º</h3><p>æ¯æ¬¡ TestFlight å‘å¸ƒæµ‹è¯•éƒ½ä¼šè¯¢é—®ä½ çš„ app æœ‰æ²¡æœ‰ä½¿ç”¨åŠ å¯†æŠ€æœ¯ï¼Œå‹¾é€‰å®Œåæ‰èƒ½æµ‹è¯•ã€‚è¿™æ—¶å¯ä»¥åœ¨ <code>Info.plist</code> æ·»åŠ  <code>ITSAppUsesNonExemptEncryption</code> ä¸º <code>false</code> å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;ITSAppUsesNonExemptEncryption&lt;/key&gt;&lt;false/&gt;</span><br></pre></td></tr></table></figure><p>ä¸‹æ¬¡æ‰“åŒ…ä¸Šä¼ ï¼Œæ¥æ”¶åˆ° App Store Connect é‚®ä»¶ has completed processing å°±èƒ½è‡ªåŠ¨å‘å¸ƒæµ‹è¯•äº†ï¼ˆinternal testingï¼‰ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://help.apple.com/itc/apploader/#/apdATD1E53-D1E1A1303-D1E53A1126">Apple help - Upload your app binary files with altool</a></p><p><a href="https://stackoverflow.com/questions/35739361/itsappusesnonexemptencryption-export-compliance-while-internal-testing">Stack Overflow - ITSAppUsesNonExemptEncryption export compliance while internal testing?</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥ä¸Šä¸€ç¯‡ï¼ŒJenkins æ„å»ºå®Œæˆåï¼Œä½¿ç”¨ altool å°† ipa ä¸Šä¼ è‡³ TestFlightã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Jenkins" scheme="https://starkrimson.github.io/tags/Jenkins/"/>
    
    <category term="Continuous integration" scheme="https://starkrimson.github.io/tags/Continuous-integration/"/>
    
    <category term="altool" scheme="https://starkrimson.github.io/tags/altool/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins + Xcode9 æŒç»­é›†æˆç¯å¢ƒæ­å»º</title>
    <link href="https://starkrimson.github.io/2018/05/29/Jenkins-with-Xcode9/"/>
    <id>https://starkrimson.github.io/2018/05/29/Jenkins-with-Xcode9/</id>
    <published>2018-05-29T02:17:00.000Z</published>
    <updated>2022-04-07T04:04:05.529Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ­å»ºäº†ä¸€å¥— Jenkins + Xcode9 æŒç»­é›†æˆç¯å¢ƒï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h3 id="å®‰è£…-Jenkins"><a href="#å®‰è£…-Jenkins" class="headerlink" title="å®‰è£… Jenkins"></a>å®‰è£… Jenkins</h3><p>æ¨èé€šè¿‡ homebrew å®‰è£…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹è½½ pkg åŒ…å®‰è£…ï¼ˆ<a href="https://jenkins.io/download/thank-you-downloading-osx-installer/">Jenkins OSX Installer</a>ï¼‰ï¼Œä¸è¿‡è¿˜æ˜¯ brew æ–¹ä¾¿äº›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install jenkins</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡å®‰è£… Javaï¼Œéœ€è¦å…ˆè£…ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install caskroom/versions/java8</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–é…ç½®"><a href="#åˆå§‹åŒ–é…ç½®" class="headerlink" title="åˆå§‹åŒ–é…ç½®"></a>åˆå§‹åŒ–é…ç½®</h3><p>è¿™é‡Œæä¸€ä¸‹å…³é”®çš„ç‚¹ï¼Œå°±ä¸ä¸€ä¸€æˆªå›¾ç»†è¯´äº†ã€‚</p><p>æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="http://localhost:8080/">http://localhost:8080</a></p><p>ç¬¬ä¸€æ¬¡æ‰“å¼€ä¼šæç¤ºå»å– <code>initialAdminPassword</code>ï¼ˆä¸€è¡Œçº¢å­—æ ‡æ˜è·¯å¾„ï¼Œå¾ˆæ˜æ˜¾ï¼‰é‡Œçš„å¯†ç ã€‚<code>cat path/to/initialAdminPassword</code> æ‹¿åˆ°åè´´åˆ°è¾“å…¥æ¡†ä¸­ nextã€‚</p><p>â†’ å®‰è£…æ¨èçš„æ’ä»¶ â†’ åˆ›å»ºç”¨æˆ·ã€‚å®Œæˆåé‡æ–°ç™»å½• Jenkinsã€‚</p><p>æ¥ä¸‹æ¥åœ¨ Manage Jenkins -&gt; Manage Plugins -&gt; Available å®‰è£…ä¸€äº›éœ€è¦çš„æ’ä»¶ï¼š</p><ul><li><p>Xcode integration</p></li><li><p><del>Keychains and Provisioning Profiles Management</del></p><p>å¯èƒ½ä¸€äº›æ•™ç¨‹æ¨èè£…è¿™ä¸ªæ’ä»¶ï¼Œç„¶åé…ç½®ä¸€ä¸‹ login.keychain å¡«ä¸€äº›è¯ä¹¦ä¿¡æ¯ä»€ä¹ˆçš„å°±å¾ˆæ–¹ä¾¿å¯¼å‡º <code>.ipa</code> äº†ã€‚<strong>but</strong>ï¼Œå¾ˆé—æ†¾ Xcode9 æ— æ³•è¯»å– login.keychain çš„ä¿¡æ¯ï¼Œç°åœ¨å¯¼å‡ºéœ€è¦æä¾›ä¸€ä»½ <code>ExportOptions.plist</code>ï¼Œåé¢å†å…·ä½“è¯´æ€ä¹ˆæ“ä½œã€‚</p></li><li><p>GIT plugin</p></li><li><p>Git Parameter</p></li></ul><h3 id="å±€åŸŸç½‘å†…è®¿é—®-Jenkins"><a href="#å±€åŸŸç½‘å†…è®¿é—®-Jenkins" class="headerlink" title="å±€åŸŸç½‘å†…è®¿é—® Jenkins"></a>å±€åŸŸç½‘å†…è®¿é—® Jenkins</h3><p>ä½¿ç”¨ brew å®‰è£… Jenkins é»˜è®¤å°† <code>httpListenAddress</code> è®¾ç½®ä¸º <code>127.0.0.1</code>ï¼Œæœ¬æœºå¯ä»¥é€šè¿‡ <code>localhost:8080</code> è®¿é—®ï¼Œä½†å±€åŸŸç½‘å†…æ— æ³•é€šè¿‡ <code>æœ¬æœº ip:8080</code> è®¿é—®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</span><br><span class="line">/usr/local/opt/jenkins/homebrew.mxcl.jenkins.plist</span><br></pre></td></tr></table></figure><p>å°†ä¸¤ä¸ª plist æ–‡ä»¶ä¸­ <code>httpListenAddress</code> æ”¹ä¸º 0.0.0.0 é‡å¯ Jenkins å³å¯ã€‚</p><p>é‡å¯ Jenkins å¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart jenkins</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨æµè§ˆå™¨é‡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/restart</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-x2F-é…ç½®é¡¹ç›®"><a href="#åˆ›å»º-x2F-é…ç½®é¡¹ç›®" class="headerlink" title="åˆ›å»º&#x2F;é…ç½®é¡¹ç›®"></a>åˆ›å»º&#x2F;é…ç½®é¡¹ç›®</h3><p>Net Item â†’ è¾“å…¥ item name â†’ Freestyle project â†’ OK</p><p>Source Code Management é€‰æ‹© Gitï¼Œå¹¶å¡«å…¥ç›¸åº”çš„ä¿¡æ¯ã€‚</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1frr84t10nfj317y0vsjv2.jpg" alt="Git ä¿¡æ¯"></p><p>åˆ‡æ¢åˆ° Build æ ï¼ŒæŒ‰é¡ºåºæ·»åŠ  build stepã€‚</p><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨ Cocoapodsï¼Œé¦–å…ˆå®‰è£… pod çš„ç¬¬ä¸‰æ–¹åº“ã€‚</p><p>ç‚¹å‡» Add build step â†’ Execute shell</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1frr84rhaq6j317y09i0ti.jpg" alt="add execute shell"></p><p>åˆ‡æ¢çš„ Podfile æ–‡ä»¶ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ pod install å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -l</span></span><br><span class="line">cd $&#123;JOB_NAME&#125;</span><br><span class="line">export LANG=en_US.UTF-8</span><br><span class="line">pod install --verbose --no-repo-update</span><br></pre></td></tr></table></figure><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1frr84ugauyj31820bwq4n.jpg" alt="pod install"></p><p>æ¥ä¸‹æ¥æ·»åŠ å¦ä¸€ä¸ª build stepï¼Œè¿™æ¬¡é€‰æ‹©çš„æ˜¯ Xcodeã€‚</p><p>ä½¿ç”¨ Cocoapodsï¼ŒTarget è¿™æ ä¸ç”¨å¡«ï¼Œç‚¹å‡»å³ä¾§çš„ Settingsï¼ŒæŒ‰æˆªå›¾è®¾ç½®ä¸‹ã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1frr84thlr7j318413ated.jpg" alt="Xcode general settings"></p><p>Code signing &amp; OS X keychain options å¯ä»¥ä¸è®¾ç½®ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1frr84s2xghj317u16an3m.jpg" alt="Xcode advanced options"></p><p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„çš„åœ°æ–¹ï¼Œåœ¨ Xcode9 ä»¥å‰ï¼Œå¯ä»¥å‹¾é€‰åº•ä¸‹çš„ Pack application, build and sign .ipa?ï¼Œå¹¶è®¾ç½®äº›ç›¸å…³çš„ä¿¡æ¯å°±èƒ½å¯¼å‡º .ipaã€‚ä½†æ˜¯ä½¿ç”¨ Xcode9 ä¼šæŠ¥è¿™æ ·çš„é”™è¯¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Error Domain=IDEProvisioningErrorDomain Code=9 \&quot;\&quot;MyApp.app\&quot; requires a provisioning profile.\&quot; UserInfo=&#123;NSLocalizedDescription=\&quot;MyApp.app\&quot; requires a provisioning profile., NSLocalizedRecoverySuggestion=Add a profile to the \&quot;provisioningProfiles\&quot; dictionary in your Export Options property list.&#125;&quot;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€å°±æ˜¯éœ€è¦æŒ‡å®š ExportOptions.plistï¼Œè¿™ä¸ªæ–‡ä»¶å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>compileBitcode<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>method<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>ad-hoc<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>provisioningProfiles<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>âš ï¸ Bundle ID <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>âš ï¸ Provisioning Profile <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>signingCertificate<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>iPhone Distribution<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>signingStyle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>manual<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>stripSwiftSymbols<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>teamID<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>âš ï¸ teamID <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>thinning<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="symbol">&amp;lt;</span>none<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‹·è´ç„¶åä¿®æ”¹ä¸€ä¸‹ç›¸åº”çš„ key valueã€‚ä¸è¿‡ä¸€ä¸ªç®€å•è·å–è¿™ä¸ªæ–‡ä»¶çš„æ–¹å¼æ˜¯ï¼šæ‰‹åŠ¨ä½¿ç”¨ Xcode9 æ‰“åŒ…ï¼Œåœ¨å¯¼å‡º <code>.ipa</code> çš„æ–‡ä»¶å¤¹é‡Œåº”è¯¥æœ‰ 4 ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯ <code>ExportOptions.plist</code>ã€‚å¯ä»¥æŠŠå®ƒæ‹·è´åˆ° workspace ç›®å½•ä¸‹ã€‚</p><p>â˜•ï¸ è¡¥å……ï¼šå¦‚æœ Signing å‹¾é€‰äº† Automatically manage signingï¼Œå°±ç®€å•å¤šäº†ï¼Œå®ƒçš„ <code>exportOptons.plist</code> æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>compileBitcode<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>method<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>ad-hoc<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>signingStyle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>automatic<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>stripSwiftSymbols<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>teamID<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>âš ï¸ teamID<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>thinning<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="symbol">&amp;lt;</span>none<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1frukz16h83j30tw09e3zn.jpg" alt="image-20180531155611396"></p><p>åœ¨ Xcode step ä¸‹é¢å†æ·»åŠ ä¸€ä¸ª Execute shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild -exportArchive -archivePath $&#123;WORKSPACE&#125;/build/$&#123;JOB_NAME&#125;.xcarchive -exportPath $&#123;JENKINS_HOME&#125;/jobs/$&#123;JOB_NAME&#125;/builds/$&#123;BUILD_NUMBER&#125;/archive -exportOptionsPlist $&#123;WORKSPACE&#125;/ExportOptions.plist</span><br></pre></td></tr></table></figure><p><code>-exportOptionsPlist $&#123;WORKSPACE&#125;/ExportOptions.plist</code> è¿™ä¸ªé€‰é¡¹å°±æ˜¯æŒ‡å®šåˆšåˆšæ‹·è´åˆ° workspace çš„ plistã€‚</p><p>åˆ°è¿™é‡Œé…ç½®å°±å®Œæˆäº†ã€‚å›åˆ° item é¡µé¢ï¼Œç‚¹å‡» Build Nowã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1frr84pmj21j315e0f8gnr.jpg" alt="Build Now"></p><p>å·¦ä¾§å°±èƒ½çœ‹åˆ° building çš„é¡¹ç›®äº†ï¼Œç‚¹å‡» Console Output å¯ä»¥çœ‹åˆ° log è®°å½•ï¼Œå¦‚æ— æ„å¤–æœ€åè¾“å‡º <code>Finished: SUCCESS</code>ã€‚</p><p>å¯ä»¥åœ¨ä¸¤ä¸ªç›®å½•æ‰¾åˆ° <code>.xcarchive</code> å’Œ <code>.ipa</code> :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/Users/yourname/.jenkins/workspace/jobName/build/jobName.xcarchive</span><br><span class="line">/Users/yourname/.jenkins/jobs/jobName/builds/buildNumber/archive</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-Git-Parameter"><a href="#é…ç½®-Git-Parameter" class="headerlink" title="é…ç½® Git Parameter"></a>é…ç½® Git Parameter</h3><p>æœ‰æ—¶å€™æƒ³æŒ‡å®šæ‰“æŸä¸ªåˆ†æ”¯çš„åŒ…ï¼Œç”¨ Git Parameter å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p><p>å›åˆ°é…ç½®é¡µæœ€é¡¶éƒ¨ï¼Œå‹¾é€‰ This project is parameterizedï¼Œé€‰æ‹© Git Parameter</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1frr84tyuj5j30sk0d2tae.jpg" alt="add parameter"></p><p>ï¿¼ï¿¼<img src="https://ws2.sinaimg.cn/large/006tNc79gy1frr84q4utxj317u0fswg3.jpg" alt="Git Parameter é…ç½®"></p><p>Name åé¢éœ€è¦ç”¨åˆ°ï¼ŒType è¿™é‡Œå°±é€‰ Branch äº†ã€‚</p><p>å†åˆ° Source Code Managementï¼Œä¿®æ”¹ä¸€ä¸‹è®¾ç½®ã€‚</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1frr84sl33bj317y0uwdj9.jpg" alt="Source code management"></p><p>çº¢æ¡†éƒ¨åˆ†ä¿®æ”¹ä¸ºåˆšåˆšè®¾ç½®çš„ Nameï¼Œä»¥ <code>$</code> å¼€å¤´ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1frr84qm8mtj31120fe769.jpg" alt="Build with Parameters"></p><p>è¿™æ—¶ Build Now å°±å˜æˆ Build with Parameters äº†ã€‚å³ä¾§é€‰æ‹©åˆ†æ”¯ï¼Œç„¶åå¼€ buildã€‚</p><p><del>è¿™ä¸ªæ’ä»¶é€‚åˆæ‰‹åŠ¨æ„å»ºï¼Œå¦‚æœè®¾ç½®äº†è½®è¯¢è‡ªåŠ¨æ„å»ºï¼Œä¼šå› ä¸ºæ‰¾ä¸åˆ°åˆ†æ”¯è€Œæ„å»ºå¤±è´¥ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆå‘Šè¯‰æˆ‘å•Šã€‚</del></p><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fsxjm3xge9j30wm0c4gmo.jpg" alt="image-20180703103936525"></p><p>ç‚¹å‡»å³ä¾§çš„ Advancedï¼Œæœ‰ä¸€æ ã€ŒDefault Valueã€å¯ä»¥æŒ‡å®šé»˜è®¤çš„åˆ†æ”¯ã€‚è¿™æ ·è½®è¯¢æ„å»ºçš„æ—¶å€™å°±ä¼šè‡ªåŠ¨é€‰æ‹©è¿™ä¸ªåˆ†æ”¯ã€‚</p><h3 id="è·å–-Bundle-ID-å’Œ-Provisioning-Profile-ç”Ÿæˆ-ExportOptions-plist"><a href="#è·å–-Bundle-ID-å’Œ-Provisioning-Profile-ç”Ÿæˆ-ExportOptions-plist" class="headerlink" title="è·å– Bundle ID å’Œ Provisioning Profile ç”Ÿæˆ ExportOptions.plist"></a>è·å– Bundle ID å’Œ Provisioning Profile ç”Ÿæˆ ExportOptions.plist</h3><p>â˜•ï¸ è¡¥å……ï¼šSigning å‹¾é€‰äº† Automatically manage signing å¯ä»¥ä¸æ“ä½œè¿™æ­¥ã€‚</p><p>ç°åœ¨å¯ä»¥æŒ‡å®šä»»æ„çš„åˆ†æ”¯æ‰“åŒ…äº†ï¼Œä½†å¯èƒ½æ¯ä¸ªåˆ†æ”¯çš„ Bundle ID æˆ–è€… Provisioning Profile è·Ÿä¹‹å‰å‡†å¤‡çš„ exportOptions ä¸ä¸€è‡´ï¼Œè¿™æ ·å°±å¾—å‡†å¤‡å¤šä¸€ä»½ ExportOptions.plistã€‚å°±å†™ä¸ªè„šæœ¬æ¥è·å–å§ã€‚</p><p>æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼Œå…ˆå‡†å¤‡ä¸€ä»½ exportOptions æ¨¡ç‰ˆï¼Œé€šè¿‡ <code>xcodebuild -showBuildSettings</code> è·å– Bundle ID å’Œ Provisioning Profileï¼Œæ›¿æ¢æ¨¡ç‰ˆç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>.plist</code>ï¼Œexport å‘½ä»¤æŒ‡å®šè¿™ä¸ªæ–°çš„ <code>.plist</code> å°±å¥½äº†ã€‚</p><p>åœ¨ <code>xcodebuild -exportArchive</code> å‰ Add execute shell</p><p>è¿™é‡Œå°±ç©ç© Swift è„šæœ¬äº†ï¼Œåœ¨æ–‡æœ¬å¼€å¤´åŠ ä¸Š <code>!/usr/bin/env swift</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#<span class="operator">!/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>env swift</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€æ®µ Swift å†™çš„è„šæœ¬ï¼ˆå¥½ç©ï¼‰</span></span><br><span class="line"><span class="comment">// ä½œç”¨æ˜¯ä» xcodebuild ä¸­è·å– bundle id å’Œ provisioning profile</span></span><br><span class="line"><span class="comment">// è¾“å‡ºæ–°çš„ export options plistï¼Œåœ¨å¯¼å‡º ipa æ—¶éœ€è¦ç”¨åˆ°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">executeShell</span>(<span class="keyword">_</span> <span class="params">arguments</span>: <span class="type">String</span>...) -&gt; (status: <span class="type">Int32</span>, output: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> process <span class="operator">=</span> <span class="type">Process</span>()</span><br><span class="line">    process.launchPath <span class="operator">=</span> <span class="string">&quot;/usr/bin/env&quot;</span></span><br><span class="line">    process.arguments <span class="operator">=</span> arguments</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> pipe <span class="operator">=</span> <span class="type">Pipe</span>()</span><br><span class="line">    process.standardOutput <span class="operator">=</span> pipe</span><br><span class="line"></span><br><span class="line">    process.launch()</span><br><span class="line">    process.waitUntilExit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> pipe.fileHandleForReading.readDataToEndOfFile()</span><br><span class="line">    <span class="keyword">let</span> output <span class="operator">=</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">    <span class="keyword">return</span> (process.terminationStatus, output <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> profiles <span class="operator">=</span> executeShell(<span class="string">&quot;xcodebuild&quot;</span>, <span class="string">&quot;-showBuildSettings&quot;</span>).output</span><br><span class="line">    .components(separatedBy: <span class="string">&quot;<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    .filter &#123;</span><br><span class="line">        <span class="variable">$0</span>.range(of: <span class="string">&quot;PRODUCT_BUNDLE_IDENTIFIER&quot;</span>) <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">||</span> <span class="variable">$0</span>.range(of: <span class="string">&quot;PROVISIONING_PROFILE_SPECIFIER&quot;</span>) <span class="operator">!=</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.replacingOccurrences(of: <span class="string">&quot; &quot;</span>, with: <span class="string">&quot;&quot;</span>).components(separatedBy: <span class="string">&quot;=&quot;</span>).last <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;profiles: <span class="subst">\(profiles)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> directoryPath <span class="operator">=</span> <span class="string">&quot;/Users/yourname/Documents/ExportOptions/&quot;</span></span><br><span class="line"><span class="keyword">let</span> options <span class="operator">=</span> <span class="type">NSMutableDictionary</span>(contentsOfFile: directoryPath <span class="operator">+</span> <span class="string">&quot;ExportOptions_sample.plist&quot;</span>)</span><br><span class="line">options<span class="operator">?</span>[<span class="string">&quot;provisioningProfiles&quot;</span>] <span class="operator">=</span> [profiles[<span class="number">0</span>] : profiles[<span class="number">1</span>]]</span><br><span class="line">options<span class="operator">?</span>.write(toFile: directoryPath <span class="operator">+</span> <span class="string">&quot;ExportOptions.plist&quot;</span>, atomically: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>åé¢çš„ <code>-exportOptionsPlist</code> æŒ‡å®š <code>directoryPath/ExportOptions.plist</code> ã€‚</p><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>é‡‡ç”¨ xcodebuild test + <a href="https://github.com/supermarin/xcpretty">xcpretty</a> æ–¹æ¡ˆã€‚</p><p>xcpretty å¯ä»¥å°† xcodebuild test è¾“å‡ºå†…å®¹æ ¼å¼åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å¯¼å‡º xmlã€json æˆ–è€… htmlã€‚</p><p>æ ¼å¼åŒ–çš„å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   âœ“ testExample (0.001 seconds)</span><br><span class="line">   â—· testPerformanceExample measured (0.000 seconds)</span><br><span class="line">   âœ“ testPerformanceExample (0.362 seconds)</span><br><span class="line">   âœ— testString, XCTAssertTrue failed - è¿”å›ä¸æ˜¯ã€Œä½ å¥½ä¸–ç•Œã€ï¼Œæµ‹è¯•ä¸é€šè¿‡</span><br><span class="line"></span><br><span class="line">testString, XCTAssertTrue failed - è¿”å›ä¸æ˜¯ã€Œä½ å¥½ä¸–ç•Œã€ï¼Œæµ‹è¯•ä¸é€šè¿‡</span><br><span class="line">xx.swift:47</span><br><span class="line">   func testString() &#123;</span><br><span class="line">       XCTAssert(viewCtrl.returnAString() == &quot;ä½ å¥½ä¸–ç•Œ&quot;, &quot;è¿”å›ä¸æ˜¯ã€Œä½ å¥½ä¸–ç•Œã€ï¼Œæµ‹è¯•ä¸é€šè¿‡&quot;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®‰è£… xcpretty ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install xcpretty</span><br></pre></td></tr></table></figure><p>Add execute shell:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild test \</span><br><span class="line">-workspace $&#123;JOB_NAME&#125;.xcworkspace \</span><br><span class="line">-scheme $&#123;JOB_NAME&#125; \</span><br><span class="line">-destination &#x27;platform=iOS Simulator,name=iPhone 7&#x27; \</span><br><span class="line">| xcpretty -s -r html \</span><br><span class="line">--output $&#123;JENKINS_HOME&#125;/jobs/$&#123;JOB_NAME&#125;/builds/$&#123;BUILD_NUMBER&#125;/tests.html \</span><br><span class="line">&amp;&amp; exit $&#123;PIPESTATUS[0]&#125;</span><br></pre></td></tr></table></figure><p><code>&amp;&amp; exit $&#123;PIPESTATUS[0]&#125;</code> ä½¿ç”¨ exit å‚æ•°å¸®åŠ© Jenkins ç¡®å®šæ˜¯å¦å¤±è´¥ã€‚</p><p>å¯ä»¥æŠŠè¿™æ®µ shell æ”¾åœ¨ pod install ä¹‹åï¼Œæµ‹è¯•å¤±è´¥å build å¤±è´¥è€Œä¸ç»§ç»­ archiveã€‚</p><h3 id="ä¸Šä¼ -ipa-åˆ°æµ‹è¯•å¹³å°"><a href="#ä¸Šä¼ -ipa-åˆ°æµ‹è¯•å¹³å°" class="headerlink" title="ä¸Šä¼  ipa åˆ°æµ‹è¯•å¹³å°"></a>ä¸Šä¼  ipa åˆ°æµ‹è¯•å¹³å°</h3><p>ä½ å¯ä»¥æ‰¾åˆ°å¹³å°æä¾›çš„é›†æˆæ–‡æ¡£ï¼Œä¾‹å¦‚ <a href="http://blog.fir.im/jenkins/">fir.im Jenkins æ’ä»¶ä½¿ç”¨æ–¹æ³•</a> æˆ–è€… <a href="https://www.pgyer.com/doc/view/jenkins_ios">è’²å…¬è‹± - ä½¿ç”¨ Jenkins å®ç°æŒç»­é›†æˆ (iOS)</a></p><p>è¿™é‡Œæ¼”ç¤ºä½¿ç”¨ <a href="https://github.com/bumaociyuan/ios-ipa-server">ios-ipa-server</a> æ­å»ºã€Œæœ¬åœ°è‡ªç­¾å https æœåŠ¡å™¨ï¼Œå¿«é€Ÿå®‰è£… ipaã€ã€‚</p><h4 id="å®‰è£…-ios-ipa-server"><a href="#å®‰è£…-ios-ipa-server" class="headerlink" title="å®‰è£… ios-ipa-server"></a>å®‰è£… ios-ipa-server</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ios-ipa-server</span><br></pre></td></tr></table></figure><h4 id="å¼€å¯-ios-ipa-server"><a href="#å¼€å¯-ios-ipa-server" class="headerlink" title="å¼€å¯ ios-ipa-server"></a>å¼€å¯ ios-ipa-server</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /path/of/ipa</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ios-ipa-server</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ios-ipa-server /path/of/ipa</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">open https://ip:port/download on your iphone</span></span><br></pre></td></tr></table></figure><h4 id="å°†å¯¼å‡ºçš„-ipa-æ–‡ä»¶å¤åˆ¶åˆ°-ios-ipa-server-ç›®å½•"><a href="#å°†å¯¼å‡ºçš„-ipa-æ–‡ä»¶å¤åˆ¶åˆ°-ios-ipa-server-ç›®å½•" class="headerlink" title="å°†å¯¼å‡ºçš„ ipa æ–‡ä»¶å¤åˆ¶åˆ° ios-ipa-server ç›®å½•"></a>å°†å¯¼å‡ºçš„ ipa æ–‡ä»¶å¤åˆ¶åˆ° ios-ipa-server ç›®å½•</h4><p>add Execute Shellï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -l</span></span><br><span class="line">cd $&#123;JENKINS_HOME&#125;/jobs/$&#123;JOB_NAME&#125;/builds/$&#123;BUILD_NUMBER&#125;/archive</span><br><span class="line">DATE=$(date +%m%d-%H:%M)</span><br><span class="line">DISPLAY_NAME=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleDisplayName&quot; $&#123;WORKSPACE&#125;/$&#123;JOB_NAME&#125;/Info.plist)</span><br><span class="line">cp $&#123;JOB_NAME&#125;.ipa ~/Documents/ipa/$&#123;DISPLAY_NAME&#125;$&#123;DATE&#125;.ipa</span><br></pre></td></tr></table></figure><p>å…³äºè¯ä¹¦é—®é¢˜ï¼ŒiOS 10.3 (ä¸ç¡®å®šç‰ˆæœ¬äº†) ä»¥ä¸Šé™¤äº†éœ€è¦å®‰è£…æè¿°æ–‡ä»¶å¤–ï¼Œè¿˜éœ€è¦åˆ°ã€Œå…³äºæœ¬æœºã€- ã€Œè¯ä¹¦ä¿¡ä»»è®¾ç½®ã€å°† ios-ipa-server å¼€å¯ã€‚</p><h3 id="Build-Triggers"><a href="#Build-Triggers" class="headerlink" title="Build Triggers"></a>Build Triggers</h3><p>å¯ä»¥è®¾ç½®ä¸€äº›è§¦å‘æ„å»ºæ¡ä»¶ã€‚</p><h4 id="Trigger-builds-remotely"><a href="#Trigger-builds-remotely" class="headerlink" title="Trigger builds remotely"></a>Trigger builds remotely</h4><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fsxjm4steoj317i0c2mzi.jpg" alt="image-20180703105112845"></p><p>åœ¨è¿œç¨‹ç»ˆç«¯å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ¥è§¦å‘æ„å»ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://username:password@ipAddr:8080/job/jobName/build\?token\=tokenName</span><br></pre></td></tr></table></figure><p>æˆ–è€… <code>/buildWithParameters?</code>ï¼ŒæŒ‡å®š Git Parameter çš„åˆ†æ”¯ <code>&amp;Branches=master</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://username:password@ipAddr:8080/job/jobName/buildWithParameters\?token\=tokenName\&amp;Branches\=master</span><br></pre></td></tr></table></figure><h5 id="Poll-SCM"><a href="#Poll-SCM" class="headerlink" title="Poll SCM"></a>Poll SCM</h5><p>Poll SCM å¯ä»¥è®¾ç½®ä¸€ä¸ªè½®è¯¢å‘¨æœŸï¼Œå½“ Git ä¸Šæœ‰ä»£ç æ›´æ–°æ‰ä¼šè§¦å‘æ„å»ºï¼š</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fsxjm5qj7ij316e08sq42.jpg" alt="image-20180703110056338"></p><h3 id="å¯èƒ½å‡ºç°çš„é”™è¯¯å’Œè§£å†³"><a href="#å¯èƒ½å‡ºç°çš„é”™è¯¯å’Œè§£å†³" class="headerlink" title="å¯èƒ½å‡ºç°çš„é”™è¯¯å’Œè§£å†³"></a>å¯èƒ½å‡ºç°çš„é”™è¯¯å’Œè§£å†³</h3><h4 id="pod-command-not-found"><a href="#pod-command-not-found" class="headerlink" title="pod: command not found"></a>pod: command not found</h4><p>Execute shell ç¬¬ä¸€è¡ŒåŠ ä¸Š <code>!/bin/bash -l</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -l</span></span><br><span class="line">cd FirstiOSItem</span><br><span class="line">export LANG=en_US.UTF-8</span><br><span class="line">pod install --verbose --no-repo-update</span><br></pre></td></tr></table></figure><p>export è¯­å¥å°†æ§åˆ¶å°è¯­è¨€ç¯å¢ƒè®¾ç½®ä¸º UTF-8</p><h4 id="xcode-select-error-tool-â€˜xcodebuildâ€™-requires-Xcode"><a href="#xcode-select-error-tool-â€˜xcodebuildâ€™-requires-Xcode" class="headerlink" title="xcode-select: error: tool â€˜xcodebuildâ€™ requires Xcode"></a>xcode-select: error: tool â€˜xcodebuildâ€™ requires Xcode</h4><p>  xcode è·¯å¾„é”™è¯¯ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹ï¼š</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer/</span><br><span class="line">xcodebuild -showsdks</span><br><span class="line">xcrun --sdk iphoneos --show-sdk-path</span><br></pre></td></tr></table></figure><h4 id="error-exportArchive-â€œxx-appâ€-requires-a-provisioning-profile-Jenkins"><a href="#error-exportArchive-â€œxx-appâ€-requires-a-provisioning-profile-Jenkins" class="headerlink" title="error: exportArchive: â€œxx.appâ€ requires a provisioning profile Jenkins"></a>error: exportArchive: â€œxx.appâ€ requires a provisioning profile Jenkins</h4><p>æ­£æ–‡å·²è§£å†³ï¼Œå‚è€ƒ<a href="https://ermayursharma.wordpress.com/2017/11/24/how-to-add-export-option-plist-in-jenkins/">é“¾æ¥</a>ã€‚</p><h3 id="æœ€åï¼Œå¤‡ä»½-Jenkins-é…ç½®"><a href="#æœ€åï¼Œå¤‡ä»½-Jenkins-é…ç½®" class="headerlink" title="æœ€åï¼Œå¤‡ä»½ Jenkins é…ç½®"></a>æœ€åï¼Œå¤‡ä»½ Jenkins é…ç½®</h3><p>ç†è®ºä¸Šï¼ŒæŠŠ <code>Jenkins Home</code>ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ç›®å½•ä¸‹ <code>.jenkins</code> æ–‡ä»¶å¤¹ï¼Œæ‰“ä¸ª <code>.zip</code> ä¿å­˜èµ·æ¥å°±å¯ä»¥äº†ã€‚<code>thinBackup</code> å°±èƒ½åšåˆ°è¿™äº›ï¼Œå¯ä»¥å®Œå…¨å¤‡ä»½æˆ–è€…å·®å¼‚å¤‡ä»½ã€‚</p><p>ä¸è¿‡è¿™é‡Œç”¨çš„æ˜¯ GitHub ä¸Šçš„ä¸€ä¸ªè„šæœ¬(<a href="https://gist.github.com/cenkalti/5089392">Backup Jenkins home periodicallly with git.</a>)ï¼Œå°† <code>*.xml</code> é…ç½®æ–‡ä»¶ä¿å­˜åˆ° gitã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Setup</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># - Create a new Jenkins Job</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- Mark <span class="string">&quot;None&quot;</span> <span class="keyword">for</span> Source Control Management</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- Select the <span class="string">&quot;Build Periodically&quot;</span> build trigger</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  - configure to run as frequently as you like</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- Add a new <span class="string">&quot;Execute Shell&quot;</span> build step</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  - Paste the contents of this file as the <span class="built_in">command</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- Save</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">NOTE: before this job will work, you<span class="string">&#x27;ll need to manually navigate to the $JENKINS_HOME directory</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and do the initial set up of the git repository.</span></span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Make sure the appropriate remote is added and the default remote/branch set up.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"></span></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Jenkins Configuraitons Directory</span></span></span><br><span class="line">cd $JENKINS_HOME</span><br><span class="line">pwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Add general configurations, job configurations, and user content</span></span></span><br><span class="line">git add -- *.xml jobs/*/*.xml userContent/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">only add user configurations if they exist</span></span></span><br><span class="line">if [ -d users ]; then</span><br><span class="line">    user_configs=`ls users/*/config.xml`</span><br><span class="line"></span><br><span class="line">    if [ -n &quot;$user_configs&quot; ]; then</span><br><span class="line">        git add $user_configs</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">mark as deleted anything that&#x27;</span>s been, well, deleted</span></span><br><span class="line">to_remove=`git status | grep &quot;deleted&quot; | awk &#x27;&#123;print $3&#125;&#x27;`</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$to_remove&quot; ]; then</span><br><span class="line">    git rm --ignore-unmatch $to_remove</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">git commit -m &quot;Automated Jenkins commit&quot;</span><br><span class="line"></span><br><span class="line">git push -q -u origin master</span><br></pre></td></tr></table></figure><p>ï¿¼<img src="https://ws1.sinaimg.cn/large/006tNc79gy1frr84r0kdnj31800to0vw.jpg" alt="backup jenkins"></p><p>æ–°å»ºä¸€ä¸ª Itemï¼Œè®¾ç½®ä¸€ä¸ªå‘¨æœŸæ€§ Build Triggerã€‚<code>H 18 * * 5</code> è¡¨ç¤ºæ¯å‘¨äº” 18 ç‚¹â€¦</p><p>Add Execute shellï¼Œå°†ä¸Šé¢è„šæœ¬å¡«è¿›å»å°±è¡Œäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘æ­å»ºäº†ä¸€å¥— Jenkins + Xcode9 æŒç»­é›†æˆç¯å¢ƒï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Jenkins" scheme="https://starkrimson.github.io/tags/Jenkins/"/>
    
    <category term="Continuous integration" scheme="https://starkrimson.github.io/tags/Continuous-integration/"/>
    
  </entry>
  
  <entry>
    <title>ReadOn - ä¸€ä¸ª Rss é˜…è¯»å™¨</title>
    <link href="https://starkrimson.github.io/2017/09/06/ReadOnIntroduction/"/>
    <id>https://starkrimson.github.io/2017/09/06/ReadOnIntroduction/</id>
    <published>2017-09-06T09:40:00.000Z</published>
    <updated>2022-04-07T04:04:05.530Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å‘ ReadOn ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ„Ÿè§‰æ˜¯æ—¶å€™å†™ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»ä¸€ä¸‹å®ƒäº†ã€‚</p><p>é¦–å…ˆå…³äº ReadOnï¼Œå®ƒæ˜¯ä¸€æ¬¾ Rss é˜…è¯»å™¨ã€‚åœ¨è¿™é‡Œä½ å¯ä»¥æœç´¢åˆ°å–œæ¬¢çš„æºå¹¶ä¸”è®¢é˜…å®ƒï¼Œæ”¶è—å’Œåˆ†äº«ä¸€äº›æœ‰è¶£çš„æ–‡ç« ã€‚ç›®å‰å¯ä»¥åœ¨ <a href="https://itunes.apple.com/us/app/readon-%E4%B8%80%E4%B8%AA-rss-%E9%98%85%E8%AF%BB%E5%99%A8/id1212717344?l=zh&ls=1&mt=8">App Store</a> ä¸‹è½½ã€‚</p><span id="more"></span><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>ReadOn çš„å¤–è§‚éå¸¸ç®€æ´ã€‚ä½œä¸ºä¸€æ¬¾é˜…è¯» appï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯å°†å†…å®¹å æ®æ•´ä¸ªå±å¹•ã€‚æ‰€ä»¥åœ¨ä¸€å¼€å§‹è®¾è®¡çš„æ—¶å€™æˆ‘å°±å†³å®šä¸æ˜¾ç¤ºé¡¶éƒ¨çš„å¯¼èˆªæ å’Œåº•éƒ¨ tab barï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å¯¼èˆªæ ï¼Œè¦æ€ä¹ˆåšåˆ°ä¾‹å¦‚ã€Œè¿”å›ã€ã€ã€Œé€‰é¡¹ã€ç­‰åŠŸèƒ½å‘¢ï¼Ÿæ‰‹åŠ¿ï¼ŒReadOn ä½¿ç”¨äº†å¾ˆå¤šæ‰‹åŠ¿ï¼Œåƒå³æ»‘è¿”å›ã€é•¿æŒ‰èœå•ã€3D Touch é¢„è§ˆç­‰ã€‚</p><h3 id="ä¸»ç•Œé¢"><a href="#ä¸»ç•Œé¢" class="headerlink" title="ä¸»ç•Œé¢"></a>ä¸»ç•Œé¢</h3><p><img src="/images/ReadOnIntroduction/main.png"></p><p>åˆšå®‰è£…ä¸Š ReadOnï¼Œç”±äºè¿˜æ²¡æœ‰æ·»åŠ è®¢é˜…æºï¼Œé¦–é¡µæ˜¾å¾—æœ‰äº›ç©ºè¡è¡â€¦ä¾§æ»‘åˆ’å‡ºå·¦ä¾§æ ï¼Œæ·»åŠ ä¸Šè‡ªå·±å–œæ¬¢çš„æºåï¼Œä¸»ç•Œé¢é¥±æ»¡è®¸å¤šäº†ã€‚è®¢é˜…æºå°†æ ¹æ®æ–‡ä»¶å¤¹åˆ†ç»„ï¼Œå·¦ä¾§æ˜¾ç¤ºè®¢é˜…æºçš„åç§°ï¼Œå³ä¾§æ˜¾ç¤ºæœªè¯»æ•°ï¼Œå¯é€šè¿‡è®¾ç½®å…³é—­æœªè¯»æ•°çš„æ˜¾ç¤ºã€‚</p><h3 id="è®¢é˜…"><a href="#è®¢é˜…" class="headerlink" title="è®¢é˜…"></a>è®¢é˜…</h3><p><img src="/images/ReadOnIntroduction/add.png"></p><p>åœ¨ã€Œæ·»åŠ ã€é¡µé¢ã€‚è¿™é‡Œé›†æˆäº†ä¸€äº›çƒ­é—¨æºæ ‡ç­¾ï¼Œç‚¹å‡»å¯¹åº”çš„æ ‡ç­¾å³å¯æŸ¥çœ‹ç›¸å…³çš„æºã€‚æˆ–è€…è¾“å…¥å…³é”®å­—æ¥æŸ¥æ‰¾è‡ªå·±æƒ³è¦çš„æºã€‚ç‚¹å‡»æœç´¢ç»“æœï¼Œå°†å±•ç¤ºè¯¥è®¢é˜…æºçš„ç›¸å…³ä¿¡æ¯ä»¥åŠè¿‘æœŸå‘å¸ƒçš„æ–‡ç« ã€‚å³ä¸Šè§’çš„ã€Œæ·»åŠ ã€ï¼ã€Œå·²æ·»åŠ ã€æŒ‰é’®å¯ä»¥è®¢é˜…æˆ–è€…ä¸å†è®¢é˜…è¯¥æºã€‚å·²è®¢é˜…çš„æºå°†ä¼šåœ¨ä¸»ç•Œé¢å±•ç¤ºã€‚</p><h3 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h3><p><img src="/images/ReadOnIntroduction/reading.png"></p><p>åœ¨æ–‡ç« åˆ—è¡¨ä¸­ï¼Œæ¯è¡Œå±•ç¤ºè¯¥ç¯‡æ–‡ç« çš„æ ‡é¢˜ã€ä½œè€…ç­‰ä¿¡æ¯ï¼Œå¦‚æœæœ‰ç¼©ç•¥å›¾ä¹Ÿä¼šä¸€å¹¶æ˜¾ç¤ºã€‚ç‚¹å‡»æ–‡ç« å³å¯é˜…è¯»ï¼Œå¦‚å‰æ–‡æ‰€è¯´çš„ï¼Œæ–‡ç« å†…å®¹å°†å æ®æ•´ä¸ªå±å¹•ï¼Œå¯ä»¥æ›´ä¸“æ³¨äºé˜…è¯»ã€‚åº•éƒ¨æœ‰ä¸€äº›å¸¸ç”¨æŒ‰é’®ï¼Œä¾‹å¦‚è¿”å›ã€æ”¶è—ã€åˆ†äº«ç­‰ï¼Œåœ¨æ»‘åŠ¨é˜…è¯»è¿‡ç¨‹ä¸­ä¼šéšè—ã€‚</p><h3 id="æ”¶è—ã€åŒæ­¥ã€åé¦ˆ"><a href="#æ”¶è—ã€åŒæ­¥ã€åé¦ˆ" class="headerlink" title="æ”¶è—ã€åŒæ­¥ã€åé¦ˆ"></a>æ”¶è—ã€åŒæ­¥ã€åé¦ˆ</h3><p><img src="/images/ReadOnIntroduction/other.png"></p><p>å½“é˜…è¯»åˆ°å–œæ¬¢çš„æ–‡ç« ï¼Œå¯ä»¥æ”¶è—å®ƒã€‚æ”¶è—çš„æ–‡ç« ç»Ÿä¸€æ”¶å½•åœ¨ã€Œæ”¶è—ã€ä¸­ã€‚å¯ä»¥ä»å·¦ä¾§æ æ‰¾åˆ°å®ƒã€‚</p><p>åœ¨ 1.2 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘æ·»åŠ äº† iCloud åŒæ­¥è®¢é˜…æºçš„åŠŸèƒ½ã€‚å¦‚æœä½ åŒæ—¶æœ‰å‡ å°è®¾å¤‡ï¼Œå¹¶ä¸”å¸Œæœ›æ¯å°è®¾å¤‡éƒ½èƒ½çœ‹åˆ°ç»Ÿä¸€çš„è®¢é˜…æºã€‚é‚£ä¹ˆè¿™ä¸ªåŠŸèƒ½éå¸¸å¥½ï¼Œåœ¨ iPhone è®¢é˜…ä¸€ä¸ªæºåï¼Œæ‰“å¼€ iPad å°±èƒ½é˜…è¯»åˆ°è¿™ä¸ªæºçš„æ–‡ç« äº†ã€‚</p><p>å¦‚æœä½ å–œæ¬¢ğŸ˜€ï¼ˆæˆ–è€…ä¸å–œæ¬¢ğŸ˜”ï¼‰è¿™æ¬¾ appï¼Œæ¬¢è¿åˆ° App Store ç»™æˆ‘è¯„åˆ†ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é‚®ä»¶å‘Šè¯‰æˆ‘ä½ çš„å»ºè®®æˆ–è€…æ„è§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¼€å‘ ReadOn ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ„Ÿè§‰æ˜¯æ—¶å€™å†™ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»ä¸€ä¸‹å®ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…³äº ReadOnï¼Œå®ƒæ˜¯ä¸€æ¬¾ Rss é˜…è¯»å™¨ã€‚åœ¨è¿™é‡Œä½ å¯ä»¥æœç´¢åˆ°å–œæ¬¢çš„æºå¹¶ä¸”è®¢é˜…å®ƒï¼Œæ”¶è—å’Œåˆ†äº«ä¸€äº›æœ‰è¶£çš„æ–‡ç« ã€‚ç›®å‰å¯ä»¥åœ¨ &lt;a href=&quot;https://itunes.apple.com/us/app/readon-%E4%B8%80%E4%B8%AA-rss-%E9%98%85%E8%AF%BB%E5%99%A8/id1212717344?l=zh&amp;ls=1&amp;mt=8&quot;&gt;App Store&lt;/a&gt; ä¸‹è½½ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="ReadOn" scheme="https://starkrimson.github.io/tags/ReadOn/"/>
    
  </entry>
  
  <entry>
    <title>TodayExtension (Widget)</title>
    <link href="https://starkrimson.github.io/2017/04/03/TodayExtension-(Widget)/"/>
    <id>https://starkrimson.github.io/2017/04/03/TodayExtension-(Widget)/</id>
    <published>2017-04-03T02:40:00.000Z</published>
    <updated>2022-04-07T04:04:05.530Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ã€Œä»Šæ—¥è¯•å›¾ã€ä¸­æ·»åŠ ä¸€ä¸ªæ‰©å±•ï¼Œä¸»è¦ä»¥ iOS10 Widget ä¸ºä¸»ã€‚é¦–å…ˆæ‰©å±•æ˜¯é™„å±åœ¨ä¸€ä¸ªåº”ç”¨å†…çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½é€šè¿‡ AppStore ç›´æ¥ä¸‹è½½ä¸€ä¸ªæ‰©å±•ï¼Œå®ƒä¸€å®šæ˜¯å’Œå®¿ä¸» app ä¸€èµ·å®‰è£…ã€‚æ‰©å±•æœ‰è‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸‹é¢å°†ä»‹ç»å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œå¦‚ä½•ä¸å®¿ä¸» app è¿›è¡Œäº¤äº’ã€‚</p><span id="more"></span><p>demo åœ°å€ : <a href="https://github.com/Starkrimson/TodayExtension-Widget-demo">TodayExtension (Widget)</a></p><h2 id="1-æ·»åŠ -TodayExtendion-target"><a href="#1-æ·»åŠ -TodayExtendion-target" class="headerlink" title="1. æ·»åŠ  TodayExtendion target"></a>1. æ·»åŠ  TodayExtendion target</h2><p>ç‚¹é€‰èœå• <strong>File</strong> &gt; <strong>New</strong> &gt; <strong>Targetâ€¦</strong>ï¼Œåœ¨ <strong>iOS</strong> &gt; <strong>Application Extension</strong> å¯ä»¥æ‰¾åˆ° <strong>TodayExtension</strong>ï¼Œå‘½åç¡®è®¤åè®© Xcode è‡ªåŠ¨ç”Ÿæˆæ–°çš„ Schemeã€‚è¿™æ—¶é¡¹ç›®ä¸­ä¼šæœ‰ä¸€ä¸ªå’Œåˆšåˆšæ–°å»ºçš„ target çš„åŒåæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«äº†<code>TodayViewController.swift</code> <code>MainInterface.storyboard</code> <code>info.plist</code> 3ä¸ªæ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>storyboard</code>é‡Œé»˜è®¤æ·»åŠ äº†ä¸€ä¸ªã€ŒHello Wroldã€çš„ labelã€‚ç°åœ¨è¿è¡Œä¸€ä¸‹é¡¹ç›®ï¼Œä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/TodayExtension/today1.png"></p><p>å…³äº widget å†…å®¹çš„å±•ç¤ºï¼Œåœ¨ ViewController é‡Œæ§åˆ¶å°±è¡Œï¼Œå…·ä½“æƒ³è¦å±•ç¤ºçš„æ ·å­ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±å®Œæˆï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†ã€‚</p><h2 id="2-iOS10-Widget-é«˜åº¦è°ƒæ•´"><a href="#2-iOS10-Widget-é«˜åº¦è°ƒæ•´" class="headerlink" title="2. iOS10 Widget é«˜åº¦è°ƒæ•´"></a>2. iOS10 Widget é«˜åº¦è°ƒæ•´</h2><p>å¦‚ä¸Šå›¾ï¼Œä¸€ä¸ª widget çš„é«˜åº¦é»˜è®¤æ˜¯ 110ã€‚</p><ul><li>åœ¨å³ä¸Šè§’æ˜¾ç¤ºã€Œå±•å¼€&#x2F;æŠ˜å ã€æŒ‰é’®</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€åˆ¤æ–­ç³»ç»Ÿç‰ˆæœ¬ä¸º10.0ä»¥ä¸Š</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOSApplicationExtension</span> <span class="number">10.0</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">    extensionContext<span class="operator">?</span>.widgetLargestAvailableDisplayMode <span class="operator">=</span> .expanded</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Fallback on earlier versions</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/TodayExtension/today2.png"></p><ul><li>ç‚¹å‡»ã€Œå±•å¼€&#x2F;æŠ˜å ã€æŒ‰é’®çš„å›è°ƒå¹¶æ§åˆ¶é«˜åº¦</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ ·éœ€è¦åˆ¤æ–­ç‰ˆæœ¬ä¸º10.0ä»¥ä¸Š</span></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOSApplicationExtension</span> <span class="number">10.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">widgetActiveDisplayModeDidChange</span>(<span class="keyword">_</span> <span class="params">activeDisplayMode</span>: <span class="type">NCWidgetDisplayMode</span>, <span class="params">withMaximumSize</span> <span class="params">maxSize</span>: <span class="type">CGSize</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> activeDisplayMode &#123;</span><br><span class="line">    <span class="keyword">case</span> .compact:</span><br><span class="line">        preferredContentSize <span class="operator">=</span> <span class="type">CGSize</span>(width: <span class="number">0</span>, height: <span class="number">110</span>)</span><br><span class="line">    <span class="keyword">case</span> .expanded:</span><br><span class="line">        preferredContentSize <span class="operator">=</span> <span class="type">CGSize</span>(width: <span class="number">0</span>, height: <span class="number">220</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/TodayExtension/today3.png"></p><h2 id="3-ä½¿ç”¨-App-Groups-å…±äº«æ‰©å±•å’Œä¸»åº”ç”¨æ•°æ®"><a href="#3-ä½¿ç”¨-App-Groups-å…±äº«æ‰©å±•å’Œä¸»åº”ç”¨æ•°æ®" class="headerlink" title="3. ä½¿ç”¨ App Groups å…±äº«æ‰©å±•å’Œä¸»åº”ç”¨æ•°æ®"></a>3. ä½¿ç”¨ App Groups å…±äº«æ‰©å±•å’Œä¸»åº”ç”¨æ•°æ®</h2><p>ç”±äºæ²™ç›’çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨æ‰©å±•å’Œä¸»åº”ç”¨é—´å…±äº«æ•°æ®ï¼Œè¿™æ—¶å€™è¦ç”¨åˆ° <strong>App Groups</strong>ã€‚App Groups ä¸ºåŒä¸€ä¸ª vender çš„åº”ç”¨æˆ–è€…æ‰©å±•å®šä¹‰äº†ä¸€ç»„åŸŸï¼Œåœ¨è¿™ä¸ªåŸŸä¸­åŒä¸€ä¸ª group å¯ä»¥å…±äº«ä¸€äº›èµ„æºã€‚</p><ul><li>å¼€å¯ App Groups</li></ul><p>é€‰æ‹©ä¸» target çš„ <strong>Capabilities</strong> é€‰é¡¹ï¼Œæ‰¾åˆ° App Groups é€‰é¡¹ï¼Œåé¢æœ‰ä¸ªå¼€å…³å¼€å¯ã€‚å¹¶æ·»åŠ ä¸€ä¸ª goups nameã€‚è¿™é‡Œæ·»åŠ ä¸€ä¸ª<code>group.HelloTodayUserDefault</code> ã€‚ç„¶ååŒæ ·çš„åœ¨æ‰©å±•çš„ target ä¹Ÿè¿›è¡ŒåŒæ ·çš„æ­¥éª¤ã€‚<br><img src="/images/TodayExtension/today4.png"></p><ul><li>ä½¿ç”¨åŒä¸€ groups ä¸‹çš„ userDefault è¿›è¡Œæ•°æ®å…±äº«</li></ul><p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘åœ¨ä¸» target é‡Œæ·»åŠ äº†ä¸€ä¸ª textViewã€‚textView çš„æ–‡æœ¬ä¿®æ”¹åï¼Œå°†é€šè¿‡ userDefault å°†æ•°æ®å…±äº«ç»™æ‰©å±•ã€‚çœ‹ä¸‹ä»£ç ï¼š</p><p>åœ¨å®¿ä¸» app ä¸­æ›´æ”¹äº† textView çš„å€¼ï¼ŒåŒæ­¥åˆ° group çš„ userDefault ä¸­</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">textViewDidChange</span>(<span class="keyword">_</span> <span class="params">textView</span>: <span class="type">UITextView</span>) &#123;</span><br><span class="line"><span class="comment">// suiteName ä¸ Capabilities æ·»åŠ çš„ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">let</span> userDefault <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.HelloTodayUserDefault&quot;</span>)</span><br><span class="line">    userDefault<span class="operator">?</span>.set(textView.text, forKey: <span class="string">&quot;textView.value&quot;</span>)</span><br><span class="line">    userDefault<span class="operator">?</span>.synchronize()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰©å±•ä¸­è·å–æ•°æ®</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userDefault <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.HelloTodayUserDefault&quot;</span>)</span><br><span class="line">label.text <span class="operator">=</span> userDefault<span class="operator">?</span>.value(forKey: <span class="string">&quot;textView.value&quot;</span>) <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;sth. wrong&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/images/TodayExtension/today5.png"></p><h2 id="4-æ‰©å±•å’Œä¸»åº”ç”¨å…±äº«ä»£ç "><a href="#4-æ‰©å±•å’Œä¸»åº”ç”¨å…±äº«ä»£ç " class="headerlink" title="4. æ‰©å±•å’Œä¸»åº”ç”¨å…±äº«ä»£ç "></a>4. æ‰©å±•å’Œä¸»åº”ç”¨å…±äº«ä»£ç </h2><p>ä¸€ä¸ªæœ€ç®€å•çš„æ–¹å¼æ˜¯æŠŠéœ€è¦å…¬ç”¨çš„ä»£ç æ–‡ä»¶åŠ å…¥æ‰©å±• target çš„ç¼–è¯‘æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯è¿™ä¹ˆåšä¸å¥½çš„åœ°æ–¹æ˜¯ï¼Œå½“è¿™äº›å…±ç”¨çš„æ–‡ä»¶è¶Šæ¥è¶Šå¤šï¼Œæ·»åŠ åˆ° target è¿™ç§æ–¹å¼å°†éš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ã€‚iOS8 ä¹‹å apple æä¾›äº†ä¸€ä¸ªæ›´å¥½çš„æ–¹å¼ï¼Œåšæˆ Frameworkã€‚</p><p>ç‚¹é€‰ <strong>File</strong> &gt; <strong>New</strong> &gt; <strong>Target</strong>â€¦ï¼Œåœ¨ <strong>Framework &amp; Library</strong> å¯ä»¥æ‰¾åˆ° <strong>Cocoa Touch Framework</strong>ï¼Œnext å‘½åã€‚</p><p>ä¸Šé¢çš„ä»£ç é‡Œï¼ŒsuiteName æˆ‘éƒ½æ˜¯ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¾ˆä¸å¥½çš„å°±æ˜¯ä¸‡ä¸€ä¸¤ä¸ªåœ°æ–¹å†™çš„ä¸ä¸€æ ·äº†ï¼Œå°±æœ‰é—®é¢˜äº†ã€‚æ¥ä¸‹æ¥æˆ‘åœ¨ taget é‡Œæ·»åŠ ä¸€ä¸ª swift æ–‡ä»¶ï¼Œç”¨ä¸€ä¸ªå¸¸é‡æ¥è®°å½•è¿™ä¸¤ä¸ª key å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> groupSuiteName <span class="operator">=</span> <span class="string">&quot;group.HelloTodayUserDefault&quot;</span></span><br><span class="line"><span class="keyword">let</span> kTextValue <span class="operator">=</span> <span class="string">&quot;textView.value&quot;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆåœ¨ä¸»ç¨‹åºçš„ ViewController ä¸­ import åˆšåˆšæ–°å»ºçš„ Frameworkã€‚è¿™æ—¶æˆ‘å°†åŸæ¥çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¸¸é‡ï¼Œå‘ç° Xcode ä¼šæç¤ºæœªå®šä¹‰ä¹‹ç±»çš„ã€‚è¿™æ˜¯ç”±äºåŒä¸€ä¸ª module ä¸­é»˜è®¤ <code>internal</code> è®¿é—®å±‚çº§ï¼Œç°åœ¨ä»£ç å¤„äºä¸åŒçš„ moduleã€‚æ‰€ä»¥éœ€è¦æ›´æ”¹ swift æ–‡ä»¶çš„æƒé™ï¼Œåœ¨éœ€è¦åœ¨å¤–éƒ¨è®¿é—®çš„åœ°æ–¹åŠ ä¸Š <code>public</code> å…³é”®å­—</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">let</span> groupSuiteName <span class="operator">=</span> <span class="string">&quot;group.HelloTodayUserDefault&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">let</span> kTextValue <span class="operator">=</span> <span class="string">&quot;textView.value&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨ ViewController ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userDefault <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: groupSuiteName)</span><br><span class="line">userDefault<span class="operator">?</span>.set(textView.text, forKey: kTextValue)</span><br><span class="line">userDefault<span class="operator">?</span>.synchronize()</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ­¥éª¤ï¼Œå°† Framework é“¾æ¥åˆ°æ‰©å±•ä¸­</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userDefault <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: groupSuiteName)</span><br><span class="line">label.text <span class="operator">=</span> userDefault<span class="operator">?</span>.value(forKey: kTextValue) <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;sth. wrong&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯ä¼šæ”¶åˆ°ä¸€æ¡è­¦å‘Šï¼š<br><img src="/images/TodayExtension/today6.png"></p><p>è¿™æ˜¯ç”±äºä½œä¸ºæ’ä»¶ï¼Œéœ€è¦ä¸¥æ ¼éµå®ˆæ²™ç›’é™åˆ¶ï¼Œä¸€äº› API æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚é¿å…è¿™ä¸ªè­¦å‘Šï¼Œéœ€è¦åœ¨ Framework ä¸­å£°æ˜ä½¿ç”¨çš„æ˜¯æ‰©å±•å¯ç”¨çš„ APIã€‚åˆ‡æ¢åˆ° framework target ä¸­çš„ <strong>General</strong> é€‰é¡¹ï¼Œåœ¨ <strong>Deployment Info</strong> ä¸‹é¢å‹¾é€‰ <strong>Allow app extension API only</strong>ã€‚å…³äºä¸å¯ç”¨çš„ APIï¼Œapple éƒ½æ ‡æ³¨äº† <code>NS_EXTENSION_UNAVAILABLE</code>ã€‚</p><h2 id="5-ä»æ‰©å±•è¿›å…¥ä¸»ç¨‹åº"><a href="#5-ä»æ‰©å±•è¿›å…¥ä¸»ç¨‹åº" class="headerlink" title="5. ä»æ‰©å±•è¿›å…¥ä¸»ç¨‹åº"></a>5. ä»æ‰©å±•è¿›å…¥ä¸»ç¨‹åº</h2><p>æ‰©å±•æä¾›äº† <code>NSExtensionContext</code> ç±»æ¥ä¸ä¸»åº”ç”¨äº¤äº’ï¼Œè¿™é‡Œä½¿ç”¨ <code>open</code> æ–¹æ³•å°±å¥½äº†ã€‚</p><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘å°±ç›´æ¥ç»™æ‰©å±•çš„ view æ·»åŠ ä¸€ä¸ªç‚¹å‡»æ‰‹åŠ¿äº†ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ª ViewControllerï¼Œæˆ‘ç›¸ä¿¡å¼€å‘è€…ä¼šæœ‰å¾ˆå¤šæ“ä½œçš„ç©ºé—´ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">let</span> tap <span class="operator">=</span> <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(tapAction))</span><br><span class="line">    view.addGestureRecognizer(tap)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">tapAction</span>() &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;todayDemo://helloToday&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    extensionContext<span class="operator">?</span>.open(url, completionHandler: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ç¨‹åºä¸­æ·»åŠ å¯¹åº”çš„ <strong>URL Scheme</strong>ï¼š<br><img src="/images/TodayExtension/today7.png"></p><p>åœ¨ <code>AppDelegate.swift</code> ä¸­æ•è·æ‰“å¼€äº‹ä»¶ï¼Œåšå‡ºå¯¹åº”æ“ä½œï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">app</span>: <span class="type">UIApplication</span>, <span class="params">open</span> <span class="params">url</span>: <span class="type">URL</span>, <span class="params">options</span>: [<span class="params">UIApplicationOpenURLOptionsKey</span> : <span class="keyword">Any</span>] <span class="operator">=</span> [:]) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> url.scheme <span class="operator">==</span> <span class="string">&quot;todayDemo&quot;</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(url.host) <span class="comment">// -- helloToday</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>End.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ã€Œä»Šæ—¥è¯•å›¾ã€ä¸­æ·»åŠ ä¸€ä¸ªæ‰©å±•ï¼Œä¸»è¦ä»¥ iOS10 Widget ä¸ºä¸»ã€‚é¦–å…ˆæ‰©å±•æ˜¯é™„å±åœ¨ä¸€ä¸ªåº”ç”¨å†…çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½é€šè¿‡ AppStore ç›´æ¥ä¸‹è½½ä¸€ä¸ªæ‰©å±•ï¼Œå®ƒä¸€å®šæ˜¯å’Œå®¿ä¸» app ä¸€èµ·å®‰è£…ã€‚æ‰©å±•æœ‰è‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸‹é¢å°†ä»‹ç»å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œå¦‚ä½•ä¸å®¿ä¸» app è¿›è¡Œäº¤äº’ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://starkrimson.github.io/tags/Swift/"/>
    
    <category term="TodayExtension" scheme="https://starkrimson.github.io/tags/TodayExtension/"/>
    
    <category term="widget" scheme="https://starkrimson.github.io/tags/widget/"/>
    
  </entry>
  
  <entry>
    <title>3D Touch</title>
    <link href="https://starkrimson.github.io/2017/02/08/3D-Touch/"/>
    <id>https://starkrimson.github.io/2017/02/08/3D-Touch/</id>
    <published>2017-02-08T09:40:00.000Z</published>
    <updated>2022-04-07T04:04:05.529Z</updated>
    
    <content type="html"><![CDATA[<p>3D Touch æ˜¯ iPhone 6s åŠä»¥åæœºå‹å¸¦æ¥çš„æ–°åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§ç«‹ä½“è§¦æ§æŠ€æœ¯ï¼Œå¯ä»¥æ„Ÿåº”ä¸åŒçš„æ„Ÿå‹åŠ›åº¦ã€‚åœ¨ app å¼€å‘ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸‰å¤§æ¨¡å—ï¼š<code>Quick Actions</code>ã€<code>Peek and Pop</code>ã€<code>Pressure Sensitivity</code></p><span id="more"></span><blockquote><p>iPhone 6s and iPhone 6s Plus bring a powerful new dimension to the Multi-Touch interface withÂ 3D Touch. This new technology senses how deeply users press the display, letting them do more than ever with your appsÂ andÂ games.</p><p>â€” developer.apple.com</p></blockquote><p>demo åœ°å€ï¼š<a href="https://github.com/Starkrimson/3D-Touch-Demo">3D-Touch-Demo</a></p><h2 id="1-Quick-Actions"><a href="#1-Quick-Actions" class="headerlink" title="1. Quick Actions"></a>1. Quick Actions</h2><p>åœ¨ Home ç•Œé¢æŒ‰å‹ app å›¾ç‰‡ï¼Œå¯ä»¥æ˜¾ç¤ºæœ€å¤š 4 ä¸ªæ ‡ç­¾ã€‚ç‚¹å‡»ä¸åŒçš„æ ‡ç­¾å¯ä»¥è¿›å…¥ app å¹¶ä¸”å¤„ç†ç›¸åº”çš„äº‹ä»¶ã€‚ä¸‹é¢æ¥çœ‹ä¸‹å®ç°æ–¹æ³•</p><p>åˆ›å»º <code>Quick Actions</code> æœ‰ä¸¤ç§æ–¹å¼ï¼Œ1) åœ¨ info.plist æ–‡ä»¶ä¸­é™æ€å£°æ˜ï¼›2) åœ¨ç¨‹åºåˆå§‹åŒ–æ—¶åˆ©ç”¨ä»£ç åŠ¨æ€æ·»åŠ </p><ul><li>é™æ€å£°æ˜<br><img src="/images/3D-Touch/quick-actions-02.png"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;UIApplicationShortcutItems&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</span><br><span class="line">&lt;string&gt;share&lt;/string&gt;</span><br><span class="line">&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</span><br><span class="line">&lt;string&gt;åˆ†äº«&lt;/string&gt;</span><br><span class="line">&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</span><br><span class="line">&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure></li></ul><p>å¦‚ä¸Šï¼Œå…¶ä¸­<code>UIApplicationShortcutItemType</code>ã€<code>UIApplicationShortcutItemTitle </code>æ˜¯å¿…å¡«é¡¹ã€‚<code>UIApplicationShortcutItemIconType</code>ã€<code>UIApplicationShortcutItemIconFile</code>ã€<code>UIApplicationShortcutItemSubtitle</code>ä¸ºé€‰å¡«é¡¹ã€‚</p><ul><li>åŠ¨æ€æ·»åŠ </li></ul><p>é€šè¿‡ä»£ç ï¼ŒæŒ‡å®š<code>application.shortcutItems</code>å¿«æ·æ–¹å¼æ•°ç»„ï¼Œå¯åœ¨å¦‚ä¸‹æ–¹æ³•ä¸­æ·»åŠ  (å…·ä½“ä½ç½®å¯æ ¹æ®è‡ªå·±æƒ…å†µè€Œå®š)ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="params">UIApplicationLaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> shareItem <span class="operator">=</span> <span class="type">UIApplicationShortcutItem</span>(type: <span class="string">&quot;share&quot;</span>, localizedTitle: <span class="string">&quot;åˆ†äº«&quot;</span>, localizedSubtitle: <span class="literal">nil</span>, icon: <span class="type">UIApplicationShortcutIcon</span>(type: .share), userInfo: <span class="literal">nil</span>)</span><br><span class="line">    <span class="comment">// ... æ›´å¤š item è®¾ç½®</span></span><br><span class="line">    application.shortcutItems <span class="operator">=</span> [shareItem]</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºåï¼ŒæŒ‰å‹ app å›¾æ ‡ï¼Œå°†å¯ä»¥çœ‹åˆ°ä¸€ä¸ªã€Œåˆ†äº«ã€çš„æ ‡ç­¾ã€‚</p><ul><li>å“åº”å›è°ƒ</li></ul><p><code>UIApplication</code>æä¾›äº†ä¸€ä¸ªæ–¹æ³•æ¥å¬ <code>shortcutItem</code>çš„ç‚¹å‡»</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">performActionFor</span> <span class="params">shortcutItem</span>: <span class="type">UIApplicationShortcutItem</span>, <span class="params">completionHandler</span>: <span class="keyword">@escaping</span> (<span class="type">Bool</span>) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line"><span class="comment">// å¯é€šè¿‡ä¹‹å‰è®¾ç½®çš„ type å”¯ä¸€æ ‡ç¤ºåŒºåˆ†ç‚¹å‡»çš„æŒ‰é’®ï¼Œä½œå‡ºä¸åŒçš„å“åº”</span></span><br><span class="line">    <span class="keyword">switch</span> shortcutItem.type &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;share&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;clicked share&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ iOS10 ä¸­ï¼Œå¦‚æœè¯¥ app è¿˜æ·»åŠ äº† todayExtensionã€‚åœ¨æŒ‰å‹ app å›¾æ ‡åï¼Œåœ¨ quick actions ä¸Šæ–¹è¿˜ä¼šæ˜¾ç¤ºè¯¥ app çš„ widgetã€‚å¦‚æœè‡ªå¸¦çš„ã€Œå¤©æ°”ã€appã€‚</p><p><img src="/images/3D-Touch/quick-actions-03.png"></p><h2 id="2-Peek-and-Pop"><a href="#2-Peek-and-Pop" class="headerlink" title="2. Peek and Pop"></a>2. Peek and Pop</h2><p><img src="/images/3D-Touch/peek-and-pop-01.png"></p><p>Peek and Pop å¤§æ¦‚åˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼Œ1) è½»æŒ‰ï¼Œç„¦ç‚¹é«˜äº®å…¶ä½™éƒ¨åˆ†å˜æ¨¡ç³Šã€‚2) åŠ å¤§åŠ›åº¦ï¼Œå‡ºç°ç›®æ ‡ ViewController é¢„è§ˆã€‚3) è¿™æ—¶å¯ä»¥ç»§ç»­é‡å‹ push è‡³ç›®æ ‡ ViewController (æˆ–è€…è‡ªå®šä¹‰åŠ¨ä½œ)ï¼›æˆ–è€…æ‰‹æŒ‡ä¸Šæ»‘ï¼Œå°†å‡ºç°å³å›¾çš„<code>PreviewAction</code></p><p>ç”±äº 3D Touch éœ€è¦ iPhone 6s ä»¥ä¸Šæœºå‹æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ 3D Touch çš„å¯ç”¨æ€§</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traitCollection.forceTouchCapability <span class="operator">==</span> .available <span class="operator">?</span> <span class="keyword">_</span> <span class="operator">=</span> registerForPreviewing(with: <span class="keyword">self</span>, sourceView: cell) : ()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªä¸‰ç›®ï¼Œå¦‚æœæ˜¯å¯ç”¨çš„ï¼Œåˆ™æ‰§è¡Œ<code>registerForPreviewing</code>æ³¨å†Œï¼Œè®¾ç½® cell ä¸º sourceView</p><p>æ¥ä¸‹æ¥éµå¾ª<code>UIViewControllerPreviewingDelegate</code>åè®®ï¼Œå®ç°å…¶æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">ViewController</span>: <span class="title class_">UIViewControllerPreviewingDelegate</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡å‹åè§¦å‘</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">previewingContext</span>(<span class="keyword">_</span> <span class="params">previewingContext</span>: <span class="type">UIViewControllerPreviewing</span>, <span class="params">commit</span> <span class="params">viewControllerToCommit</span>: <span class="type">UIViewController</span>) &#123;</span><br><span class="line">        navigationController<span class="operator">?</span>.pushViewController(<span class="type">DetailViewController</span>(), animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›è§¦å‘ Peek äº‹ä»¶çš„åŸå§‹å›¾</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">previewingContext</span>(<span class="keyword">_</span> <span class="params">previewingContext</span>: <span class="type">UIViewControllerPreviewing</span>, <span class="params">viewControllerForLocation</span> <span class="params">location</span>: <span class="type">CGPoint</span>) -&gt; <span class="type">UIViewController</span>? &#123;</span><br><span class="line">        <span class="keyword">let</span> detailViewController <span class="operator">=</span> <span class="type">DetailViewController</span>()</span><br><span class="line">        <span class="keyword">return</span> detailViewController</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šæ»‘åå‡ºç°çš„ <code>PreviewAction</code>éœ€è¦åœ¨ç›®æ ‡ ViewController ä¸­å®ç°ã€‚åŒæ ·éœ€è¦æ³¨å†Œ <code>registerForPreviewing</code>å’Œéµå¾ª<code>UIViewControllerPreviewingDelegate</code>ã€‚å¹¶ä¸”é¢å¤–é‡å†™ä¸€ä¸ªè®¡ç®—å‹å±æ€§</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> previewActionItems: [<span class="type">UIPreviewActionItem</span>] &#123;</span><br><span class="line">    <span class="keyword">let</span> item <span class="operator">=</span> <span class="type">UIPreviewAction</span>(title: <span class="string">&quot;Greet&quot;</span>, style: .default) &#123; (action, viewController) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [item]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;3D Touch æ˜¯ iPhone 6s åŠä»¥åæœºå‹å¸¦æ¥çš„æ–°åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§ç«‹ä½“è§¦æ§æŠ€æœ¯ï¼Œå¯ä»¥æ„Ÿåº”ä¸åŒçš„æ„Ÿå‹åŠ›åº¦ã€‚åœ¨ app å¼€å‘ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸‰å¤§æ¨¡å—ï¼š&lt;code&gt;Quick Actions&lt;/code&gt;ã€&lt;code&gt;Peek and Pop&lt;/code&gt;ã€&lt;code&gt;Pressure Sensitivity&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://starkrimson.github.io/tags/Swift/"/>
    
    <category term="3D Touch" scheme="https://starkrimson.github.io/tags/3D-Touch/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ„‰å¿«åœ°å¤„ç† Optional</title>
    <link href="https://starkrimson.github.io/2016/10/29/About-Swift-Optional/"/>
    <id>https://starkrimson.github.io/2016/10/29/About-Swift-Optional/</id>
    <published>2016-10-29T00:54:00.000Z</published>
    <updated>2022-04-07T04:04:05.529Z</updated>
    
    <content type="html"><![CDATA[<p>æ¯”è¾ƒå¥½çš„å‡ ç§å¤„ç† Optional çš„æ–¹æ³•ã€‚</p><span id="more"></span><h2 id="1-ã€Œ-ã€-æ“ä½œç¬¦"><a href="#1-ã€Œ-ã€-æ“ä½œç¬¦" class="headerlink" title="1.ã€Œ ?? ã€ æ“ä½œç¬¦"></a>1.ã€Œ ?? ã€ æ“ä½œç¬¦</h2><p>åœ¨ä½¿ç”¨ <code>??</code> ä¹‹å‰ï¼Œå…ˆæ¥å¤ä¹ ä¸‹ä¸‰ç›®è¿ç®—ç¬¦ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> max <span class="operator">=</span> a <span class="operator">&gt;</span> b <span class="operator">?</span> a : b</span><br><span class="line"><span class="comment">//å¦‚æœ a &gt; b ä¸ºçœŸï¼Œè¿”å› aï¼Œ ä¸ºå‡è¿”å› bã€‚</span></span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸‹ <code>??</code> çš„ç”¨æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i: <span class="type">Int</span>? <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> x <span class="operator">=</span> i <span class="operator">??</span> <span class="number">0</span> <span class="comment">// x = 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> y: <span class="type">Int</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> z <span class="operator">=</span> y <span class="operator">??</span> <span class="number">0</span> <span class="comment">// y = 0</span></span><br></pre></td></tr></table></figure><p><code>??</code> ä¸ä¸‰ç›®è¿ç®—ç±»ä¼¼ï¼Œå¦‚æœä¸€ä¸ª optional æœ‰å€¼ï¼Œä½¿ç”¨å€¼ã€‚å¦‚æœæ²¡å€¼ï¼Œä½¿ç”¨ <code>??</code> åé¢çš„å€¼ã€‚</p><p>å¦‚æœæŒ‰ä½ <code>âŒ¥ Optoian </code> ç‚¹å‡» <code>x</code> å’Œ <code>z</code>ã€‚å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„ç±»å‹æ¨å¯¼ä¸º <code>let x: Int</code> <code>let z: Int</code>ï¼Œå¹¶<strong>ä¸æ˜¯</strong>ä¸€ä¸ªå¯é€‰å€¼</p><p>åˆ©ç”¨ <code>??</code> æ“ä½œç¬¦ï¼Œå¯ä»¥èµ·åˆ°ç»™ä¸€ä¸ª optional å±æ€§è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼çš„ä½œç”¨ã€‚ åœ¨åç»­ä½¿ç”¨ä¸­ä¸éœ€è¦è€ƒè™‘è§£åŒ…çš„é—®é¢˜ã€‚</p><h2 id="2-Optional-Binding-å¯é€‰ç»‘å®š"><a href="#2-Optional-Binding-å¯é€‰ç»‘å®š" class="headerlink" title="2. Optional Binding å¯é€‰ç»‘å®š"></a>2. Optional Binding å¯é€‰ç»‘å®š</h2><h3 id="2-1-if-let"><a href="#2-1-if-let" class="headerlink" title="2.1 if let"></a>2.1 <code>if let</code></h3><p>æ¥çœ‹ä¸€ä¸ªå°ğŸŒ°ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">contact</span>(<span class="params">name</span>: <span class="type">String</span>?, <span class="params">phone</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> name <span class="operator">=</span> name, <span class="keyword">let</span> phone <span class="operator">=</span> phone &#123;</span><br><span class="line">    <span class="comment">// åªæœ‰å½“ name å’Œ phone ä¸€å®šæœ‰å€¼ï¼Œ</span></span><br><span class="line">    æ‰ä¼šè¿›å…¥è¯¥åˆ†æ”¯</span><br><span class="line">        <span class="keyword">let</span> contact <span class="operator">=</span> name <span class="operator">+</span> <span class="string">&quot; &quot;</span> <span class="operator">+</span> phone <span class="comment">// å¯ä»¥ç›´æ¥å‚ä¸è®¡ç®—</span></span><br><span class="line">        <span class="built_in">print</span>(contact)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;name or phone nil&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­çš„å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°å¹¶ä¸”éƒ½æ˜¯å¯é€‰çš„ã€‚é‚£ä¹ˆåœ¨å‡½æ•°å†…éƒ¨å°±è¦è€ƒè™‘åˆ°å‚æ•°çš„è§£åŒ…é—®é¢˜ã€‚ä½¿ç”¨ if let å¯é€‰ç»‘å®šæˆåŠŸåï¼Œname å’Œ age éƒ½ä¸€å®šæœ‰å€¼ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚å®ƒä»¬çš„ç±»å‹æ¨å¯¼éƒ½æ˜¯éå¯é€‰å€¼ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨ä½¿ç”¨ <code>if let name = name</code> çš„æ—¶å€™ï¼Œä½¿ç”¨äº†åŒåçš„å˜é‡æ¥æ¥æ”¶å€¼ï¼Œåœ¨åç»­ä½¿ç”¨éƒ½æ˜¯éç©ºå€¼ã€‚å¯ä»¥é¿å…æƒ³å˜é‡åçš„çƒ¦æ¼â€¦</p><p>åœ¨æ•´ä¸ªå‡½æ•°å®ç°å†…éƒ¨ï¼Œæ²¡æœ‰å‡ºç°ä¸€ä¸ª <code>?</code> æˆ–è€… <code>!</code> ã€‚æ˜¯ä¸æ˜¯çœ‹åˆ°å’Œæ¸…çˆ½ï¼Ÿ(å¹¶ä¸”æ›´å®‰å…¨)</p><h3 id="2-2-guard-let"><a href="#2-2-guard-let" class="headerlink" title="2.2 guard let"></a>2.2 <code>guard let</code></h3><p>guard let åˆšå¥½ä¸ if let ç›¸å</p><p>å†æ¥ä¸€ä¸ªğŸŒ°ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">contact</span>(<span class="params">name</span>: <span class="type">String</span>?, <span class="params">phone</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> name <span class="operator">=</span> name, <span class="keyword">let</span> phone <span class="operator">=</span> phone <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å½“ name æˆ–è€… phone ä¸º nilï¼Œæ‰ä¼šè¿›å…¥è¯¥åˆ†æ”¯</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;name or phone nil&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// åœ¨åˆ†æ”¯çš„æœ€åï¼Œéœ€è¦æœ‰ return æˆ–è€… break ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è¿›å…¥ guard åˆ†æ”¯ï¼Œåˆ™ name å’Œ phone éƒ½æœ‰å€¼ï¼Œå¯ç›´æ¥å‚ä¸è®¡ç®—</span></span><br><span class="line">    <span class="keyword">let</span> contact <span class="operator">=</span> name <span class="operator">+</span> <span class="string">&quot; &quot;</span> <span class="operator">+</span> phone</span><br><span class="line">    <span class="built_in">print</span>(contact)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>guard let åœ¨æ—¥å¸¸å¼€å‘ä½¿ç”¨çš„æ›´å¤šä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ guard åˆ†æ”¯é‡Œåšä¸€äº›é”™è¯¯å¤„ç†ï¼Œç„¶åè¿”å›ã€‚</p><p>å¦‚æœæ²¡æœ‰è¿›å…¥ guard åˆ†æ”¯ï¼Œé‚£ä¹ˆåé¢é‚£äº›å˜é‡çš„éƒ½æ˜¯æœ‰å€¼çš„ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨</p><blockquote><p>åŒæ ·çš„è¿˜æœ‰ <code>if var</code> ã€ <code>guard var</code></p></blockquote><h2 id="3-Optional-Map"><a href="#3-Optional-Map" class="headerlink" title="3. Optional Map"></a>3. Optional Map</h2><p>å¦‚æœæœ‰  <code>let i: Int?</code> ï¼Œi æ˜¯ä¸€ä¸ªæ•´å‹å¯é€‰å€¼ï¼Œæˆ‘æƒ³å¯¹å®ƒ *2 å¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„å€¼ã€‚å¦‚æœ i æœ‰å€¼çš„è¯å°± *2 ç„¶åè¿”å›ï¼Œå¦‚æœæ²¡å€¼åˆ™è¿”å› nilã€‚ä½¿ç”¨å¯é€‰ç»‘å®šå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x: <span class="type">Int</span>?</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> i <span class="operator">=</span> i &#123;</span><br><span class="line">    x <span class="operator">=</span> i <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    x <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æœ‰ä¸ªæ›´ç®€æ´çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>map</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i: <span class="type">Int</span>? <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> x <span class="operator">=</span> i.map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="number">2</span> &#125; <span class="comment">// --&gt; let x: Int?; x = 200</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>map</code> å¯ä»¥æ–¹ä¾¿åœ°æ“ä½œä¸€ä¸ª optionalï¼Œè€Œä¸éœ€è¦è¿›è¡Œæ‰‹åŠ¨çš„è§£åŒ…å·¥ä½œ</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¯”è¾ƒå¥½çš„å‡ ç§å¤„ç† Optional çš„æ–¹æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://starkrimson.github.io/tags/Swift/"/>
    
    <category term="Optional" scheme="https://starkrimson.github.io/tags/Optional/"/>
    
  </entry>
  
</feed>
